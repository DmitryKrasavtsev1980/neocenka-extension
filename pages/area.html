<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neocenka - Управление областью</title>
    <link rel="stylesheet" href="../libs/tailwind/tailwind.min.css">
    <link rel="stylesheet" href="../libs/datatables/datatables.min.css">
    <link rel="stylesheet" href="../libs/slimselect/slimselect.css">
    <link rel="stylesheet" href="../libs/fotorama/fotorama.css">
    <link rel="stylesheet" href="../assets/styles/main.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="../libs/leaflet/leaflet.css">
    
    <!-- Leaflet Draw CSS -->
    <link rel="stylesheet" href="../libs/leaflet/leaflet.draw.css"/>
    
    <style>
        /* Стили для маркеров карты */
        .address-marker, .object-marker {
            border: none !important;
            background: transparent !important;
        }
        
        /* Стили для контроллера слоев */
        .leaflet-control-layers {
            background: rgba(255, 255, 255, 0.95) !important;
            border-radius: 6px !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) !important;
        }
        
        .leaflet-control-layers-list {
            margin: 8px !important;
        }
        
        .leaflet-control-layers label {
            font-size: 14px !important;
            padding: 4px 0 !important;
        }
        
        /* Popup стили */
        .leaflet-popup-content {
            margin: 8px 12px !important;
            line-height: 1.4 !important;
            max-width: 300px !important;
        }
        
        .leaflet-popup-content strong {
            font-weight: 600 !important;
        }
        
        /* Стили для кластеров объявлений */
        .listing-cluster {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border: 3px solid #ffffff;
            border-radius: 50%;
            color: white;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 2px 10px rgba(59, 130, 246, 0.4);
        }

        /* Минимальные стили для SlimSelect категорий Inpars */
        #inparsCategoriesSelect .ss-main {
            min-height: 100px;
        }
        
        /* Выравнивание высоты фильтров обработки */
        .ss-main {
            min-height: 38px !important;
        }
        
        /* Исключение для категорий Inpars */
        #inparsCategoriesSelect + .ss-main {
            min-height: 100px !important;
        }
        
        .listing-cluster.small {
            width: 30px;
            height: 30px;
            line-height: 24px;
            font-size: 12px;
        }
        
        .listing-cluster.medium {
            width: 40px;
            height: 40px;
            line-height: 34px;
            font-size: 14px;
        }
        
        .listing-cluster.large {
            width: 50px;
            height: 50px;
            line-height: 44px;
            font-size: 16px;
        }
        
        /* Стили для попапов объявлений */
        .listing-popup, .address-popup {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .listing-popup .header {
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }
        
        .listing-popup .title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }
        
        .listing-popup .price {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .listing-popup .meta {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .listing-popup .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .listing-popup .status.active {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .listing-popup .status.archived {
            background-color: #f3f4f6;
            color: #374151;
        }
        
        .listing-popup .status.needs_processing {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .listing-popup .actions {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e5e7eb;
        }
        
        .listing-popup .btn {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            margin-right: 8px;
            transition: all 0.2s;
        }
        
        .listing-popup .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .listing-popup .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .listing-popup .btn-secondary {
            background-color: #f3f4f6;
            color: #374151;
        }
        
        .listing-popup .btn-secondary:hover {
            background-color: #e5e7eb;
        }

        /* Стили для popup адресов */
        .address-popup .header {
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }

        .address-popup .address-title {
            font-size: 14px;
            font-weight: 600;
            color: #111827;
            margin-top: 4px;
        }

        .address-popup .meta {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .address-popup .actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .address-popup .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 500;
            text-decoration: none;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .address-popup .btn-sm {
            padding: 6px 12px;
            font-size: 11px;
        }

        .address-popup .btn-primary {
            background-color: #3b82f6;
            color: white;
        }

        .address-popup .btn-primary:hover {
            background-color: #2563eb;
        }

        .address-popup .btn-danger {
            background-color: #ef4444;
            color: white;
        }

        .address-popup .btn-danger:hover {
            background-color: #dc2626;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Навигация -->
    <div id="navigation-container"></div>

    <!-- Основной контент -->
    <div id="page-content" class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-lg p-6">
        <!-- Контент будет перенесен сюда -->
    </div>

    <!-- Скрытый контент для переноса -->
    <div id="area-content" class="hidden max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Хлебные крошки -->
        <div id="breadcrumbs-container"></div>

        <!-- Заголовок области -->
        <div class="px-4 py-5 border-b border-gray-200 sm:px-6">
            <div class="flex items-center justify-between">
                <div>
                    <h2 id="areaTitle" class="text-lg leading-6 font-medium text-gray-900">Загрузка...</h2>
                    <p class="mt-1 max-w-2xl text-sm text-gray-500" id="areaDescription">
                        Управление областью на карте, адресами и обработкой данных
                    </p>
                </div>
                <div class="flex space-x-3">
                    <button type="button" id="editAreaBtn" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        Редактировать
                    </button>
                </div>
            </div>
        </div>

        <!-- Статистика области (сворачиваемая панель) -->
        <div class="mt-6">
            <div class="bg-white shadow overflow-hidden sm:rounded-md">
                <div class="px-4 py-5 sm:px-6 cursor-pointer" id="statisticsPanelHeader">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Статистика области</h3>
                            <p class="mt-1 text-sm text-gray-500">Общая информация и аналитика по области</p>
                        </div>
                        <svg id="statisticsPanelChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
                
                <div id="statisticsPanelContent" class="hidden">
                    <div class="px-4 py-5 sm:p-6">
                        <!-- Счетчики статистики -->
                        <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-6">
                            <div class="bg-gray-50 overflow-hidden shadow-sm rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Площадь</dt>
                                                <dd id="segmentsCount" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-50 overflow-hidden shadow-sm rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Адресов</dt>
                                                <dd id="addressesCount" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-50 overflow-hidden shadow-sm rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Объектов</dt>
                                                <dd id="objectsCount" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-50 overflow-hidden shadow-sm rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Объявлений</dt>
                                                <dd id="listingsCount" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- График источников объявлений -->
                        <div class="bg-gray-50 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">Источники объявлений</h4>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- График -->
                                <div class="bg-white rounded-lg p-4">
                                    <div id="sourcesChart" class="w-full h-80"></div>
                                </div>
                                <!-- Таблица с данными -->
                                <div class="bg-white rounded-lg p-4">
                                    <h5 class="text-md font-medium text-gray-900 mb-3">Детализация</h5>
                                    <div id="sourcesTable" class="space-y-2">
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-600">Загрузка данных...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Аналитика определения адресов -->
                        <div class="bg-gray-50 rounded-lg p-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">Определение адресов</h4>
                            <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                                <!-- График точности определения -->
                                <div class="bg-white rounded-lg p-4">
                                    <h5 class="text-md font-medium text-gray-900 mb-3">Точность определения</h5>
                                    <div id="addressConfidenceChart" class="w-full h-64"></div>
                                </div>
                                
                                <!-- График методов определения -->
                                <div class="bg-white rounded-lg p-4">
                                    <h5 class="text-md font-medium text-gray-900 mb-3">Методы определения</h5>
                                    <div id="addressMethodsChart" class="w-full h-64"></div>
                                </div>
                                
                                <!-- Статистика и детализация -->
                                <div class="bg-white rounded-lg p-4">
                                    <h5 class="text-md font-medium text-gray-900 mb-3">Статистика</h5>
                                    <div id="addressStatsTable" class="space-y-3">
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-600">Загрузка данных...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Панель работы с данными -->
        <div class="mt-8">
            <div class="bg-white shadow overflow-hidden sm:rounded-md">
                <div class="px-4 py-5 sm:px-6 cursor-pointer" id="dataWorkPanelHeader">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Работа с данными</h3>
                            <p class="mt-1 text-sm text-gray-500">Импорт, обработка и анализ данных недвижимости</p>
                        </div>
                        <svg id="dataWorkPanelChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
                <div id="dataWorkPanelContent" class="px-4 pb-5" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                        <!-- Навигация -->
                        <div class="lg:col-span-1">
                            <nav class="flex flex-1 flex-col" aria-label="Data work navigation">
                                <ul role="list" class="-mx-2 space-y-1">
                                    <li>
                                        <a href="#" data-tab="import-addresses" class="data-nav-item group flex gap-x-3 rounded-md bg-indigo-50 p-2 pl-3 text-sm font-semibold text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            </svg>
                                            Импорт адресов
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="import-listings" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                                            </svg>
                                            Импорт объявлений
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="parse-listings" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                            </svg>
                                            Парсинг объявлений
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="update-listings" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                            </svg>
                                            Обновление объявлений
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="identify-addresses" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                                            </svg>
                                            Определение адресов
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="process-duplicates" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                            </svg>
                                            Обработка на дубли
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="delete-data" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H8a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                            Удаление данных
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                        
                        <!-- Контент -->
                        <div class="lg:col-span-3">
                            <!-- Импорт адресов -->
                            <div id="content-import-addresses" class="data-content-tab">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Импорт адресов</h4>
                                    <p class="text-sm text-gray-600 mb-4">Загрузка адресов объектов недвижимости из внешних источников</p>
                                    
                                    <button type="button" id="loadAddressesBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700 disabled:opacity-50 disabled:cursor-not-allowed">
                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                        </svg>
                                        Загрузить адреса
                                    </button>

                                    <!-- Прогресс загрузки адресов -->
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс загрузки</h5>
                                        <div class="space-y-1" data-progress="import-addresses">
                                            <div class="flex justify-between text-xs text-gray-500">
                                                <span>Загрузка адресов</span>
                                                <span id="import-addressesProgress">0%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="import-addressesProgressBar" class="bg-sky-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                            </div>
                                            <div id="import-addressesStatus" class="text-xs text-gray-500 hidden"></div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            
                            <!-- Импорт объявлений -->
                            <div id="content-import-listings" class="data-content-tab hidden">
                                <div id="inparsPanelContainer">
                                    <!-- Панель Inpars будет добавлена динамически через JavaScript -->
                                </div>
                            </div>
                            
                            <!-- Парсинг объявлений -->
                            <div id="content-parse-listings" class="data-content-tab hidden">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Парсинг объявлений</h4>
                                    <p class="text-sm text-gray-600 mb-4">Автоматический сбор объявлений с сайтов недвижимости по фильтрам области</p>
                                    
                                    <button type="button" id="parseListingsBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700">
                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                        </svg>
                                        Парсить объявления
                                    </button>

                                    <!-- Прогресс парсинга -->
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс парсинга</h5>
                                        <div class="space-y-1" data-progress="parsing">
                                            <div class="flex justify-between text-xs text-gray-500">
                                                <span>Парсинг объявлений</span>
                                                <span id="parsingProgress">0%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="parsingProgressBar" class="bg-sky-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                            </div>
                                            <div id="parsingStatus" class="text-xs text-gray-500 hidden"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Обновление объявлений -->
                            <div id="content-update-listings" class="data-content-tab hidden">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Обновление объявлений</h4>
                                    <p class="text-sm text-gray-600 mb-4">Обновление данных по существующим объявлениям</p>
                                    
                                    <button type="button" id="updateListingsBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700">
                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                        Обновить объявления
                                    </button>

                                    <!-- Прогресс обновления -->
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс обновления</h5>
                                        <div class="space-y-1" data-progress="updating">
                                            <div class="flex justify-between text-xs text-gray-500">
                                                <span>Обновление объявлений</span>
                                                <span id="updatingProgress">0%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="updatingProgressBar" class="bg-sky-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                            </div>
                                            <div id="updatingStatus" class="text-xs text-gray-500 hidden"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Определение адресов -->
                            <div id="content-identify-addresses" class="data-content-tab hidden">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Определение адресов</h4>
                                    <p class="text-sm text-gray-600 mb-4">Автоматическое определение адресов для объявлений</p>
                                    
                                    <button type="button" id="processAddressesBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700">
                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        Определить адреса
                                    </button>

                                    <!-- Прогресс обработки адресов -->
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс обработки</h5>
                                        <div class="space-y-1" data-progress="addresses">
                                            <div class="flex justify-between text-xs text-gray-500">
                                                <span>Определение адресов</span>
                                                <span id="addressesProgress">0%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="addressesProgressBar" class="bg-sky-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                            </div>
                                            <div id="addressesStatus" class="text-xs text-gray-500 hidden"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Обработка на дубли -->
                            <div id="content-process-duplicates" class="data-content-tab hidden">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Обработка на дубли</h4>
                                    <p class="text-sm text-gray-600 mb-4">Поиск и обработка дублирующихся объявлений</p>
                                    
                                    <button type="button" id="processDuplicatesBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700">
                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                        Обработать дубли
                                    </button>

                                    <!-- Прогресс обработки дублей -->
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс обработки</h5>
                                        <div class="space-y-1" data-progress="duplicates">
                                            <div class="flex justify-between text-xs text-gray-500">
                                                <span>Обработка дублей</span>
                                                <span id="duplicatesProgress">0%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="duplicatesProgressBar" class="bg-sky-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                            </div>
                                            <div id="duplicatesStatus" class="text-xs text-gray-500 hidden"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Удаление данных -->
                            <div id="content-delete-data" class="data-content-tab hidden">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Удаление объявлений</h4>
                                    <p class="text-sm text-gray-600 mb-4">Удаление объявлений из выбранной области</p>
                                    
                                    <button type="button" id="deleteDataBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700 disabled:opacity-50 disabled:cursor-not-allowed">
                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H8a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                        Удалить объявления
                                    </button>

                                    <!-- Прогресс удаления -->
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс удаления</h5>
                                        <div class="space-y-1" data-progress="delete-data">
                                            <div class="flex justify-between text-xs text-gray-500">
                                                <span>Удаление объявлений</span>
                                                <span id="delete-dataProgress">0%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="delete-dataProgressBar" class="bg-sky-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                            </div>
                                            <div id="delete-dataStatus" class="text-xs text-gray-500 hidden"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Карта -->
        <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Карта -->
            <div class="col-span-1 lg:col-span-3">
                <div class="bg-white shadow overflow-hidden sm:rounded-md">
                    <div class="px-4 py-5 sm:px-6 cursor-pointer" id="mapPanelHeader">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg leading-6 font-medium text-gray-900">Карта области</h3>
                                <p class="mt-1 text-sm text-gray-500">Интерактивная карта с адресами, объектами и объявлениями</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <svg id="mapPanelChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div id="mapPanelContent" class="px-4 pb-5" style="display: none;">
                        <div class="mb-3 flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <!-- Кнопки фильтров над картой -->
                                <div class="flex flex-wrap items-center gap-2">
                                    <button type="button" id="filterByYear" data-filter="year" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Год
                                    </button>
                                    <button type="button" id="filterBySeries" data-filter="series" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Серия
                                    </button>
                                    <button type="button" id="filterByFloors" data-filter="floors" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Этажность
                                    </button>
                                    <button type="button" id="filterByObjects" data-filter="objects" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Объектов
                                    </button>
                                    <button type="button" id="filterByListings" data-filter="listings" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        </svg>
                                        Объявлений
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <button type="button" id="refreshMapBtn" class="inline-flex items-center px-3 py-2 border border-gray-300 text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                    <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Обновить карту
                                </button>
                            </div>
                        </div>
                        <div id="map" style="height: 500px; width: 100%;z-index:0;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Таблица адресов -->
        <div class="mt-8 bg-white shadow overflow-hidden sm:rounded-md">
            <div class="px-4 py-5 sm:px-6 cursor-pointer" id="addressTableHeader">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Таблица адресов</h3>
                        <p class="mt-1 text-sm text-gray-500">Адреса в области с привязкой к объектам недвижимости</p>
                    </div>
                    <svg id="addressTableChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </div>
            </div>
            <div id="addressTableContent" class="space-y-4" style="display: none;">
                <div class="px-4 pb-2 flex justify-end">
                    <button type="button" id="addAddressBtn" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200">
                        <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Добавить адрес
                    </button>
                </div>
                <div class="px-4 pb-5">
                    <table id="addressesTable" class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Адрес</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Тип</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Конструктив</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Объектов</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Объявлений</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <!-- Данные будут загружены через JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Таблица дублей и объектов -->
        <div class="mt-8 bg-white shadow overflow-hidden sm:rounded-md">
            <div class="px-4 py-5 sm:px-6 cursor-pointer" id="duplicatesPanelHeader">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Управление дублями</h3>
                        <p class="mt-1 text-sm text-gray-500">Управление объявлениями и объектами недвижимости, требующими обработки дублей</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <!-- Фильтр статусов -->
                        <select id="duplicatesStatusFilter" class="block w-40 rounded-md border border-gray-300 bg-white px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500">
                            <option value="all">Все</option>
                            <option value="active">Активные</option>
                            <option value="archived">Архивные</option>
                            <option value="needs_processing">Требуют обработки</option>
                        </select>
                        
                        <!-- Кнопки операций -->
                        <button type="button" id="mergeDuplicatesBtn" disabled class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 disabled:bg-gray-300 disabled:cursor-not-allowed">
                            <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                            </svg>
                            Дубли
                        </button>
                        
                        <button type="button" id="splitDuplicatesBtn" disabled class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700 disabled:bg-gray-300 disabled:cursor-not-allowed">
                            <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                            Разбить дубли
                        </button>
                        
                        <svg id="duplicatesPanelChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div id="duplicatesPanelContent" class="px-4 pb-5" style="display: none;">
                <!-- Фильтры обработки -->
                <div class="mb-6 p-4 bg-gray-50 border border-gray-200 rounded-md">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-gray-900">Фильтр обработки</h4>
                        <button type="button" id="clearProcessingFiltersBtn" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                            Очистить все
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Фильтр по адресу -->
                        <div>
                            <label for="processingAddressFilter" class="block text-xs font-medium text-gray-700 mb-1">Адрес</label>
                            <select id="processingAddressFilter">
                                <option value="">Все адреса</option>
                                <!-- Опции будут загружены динамически -->
                            </select>
                        </div>
                        
                        <!-- Фильтр по типу недвижимости -->
                        <div>
                            <label for="processingPropertyTypeFilter" class="block text-xs font-medium text-gray-700 mb-1">Тип недвижимости</label>
                            <select id="processingPropertyTypeFilter">
                                <option value="">Все типы</option>
                                <option value="studio">Студия</option>
                                <option value="1k">1-к квартира</option>
                                <option value="2k">2-к квартира</option>
                                <option value="3k">3-к квартира</option>
                                <option value="4k+">4+ к квартира</option>
                            </select>
                        </div>
                        
                        <!-- Фильтр по этажу -->
                        <div>
                            <label for="processingFloorFilter" class="block text-xs font-medium text-gray-700 mb-1">Этаж</label>
                            <input type="number" id="processingFloorFilter" min="1" max="100" placeholder="Любой этаж" class="block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm placeholder:text-gray-400 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500">
                        </div>
                        
                    </div>
                    
                    <!-- Активные фильтры -->
                    <div id="activeFiltersContainer" class="mt-3 hidden">
                        <div class="flex items-center space-x-2">
                            <span class="text-xs text-gray-500">Активные фильтры:</span>
                            <div id="activeFilterTags" class="flex flex-wrap gap-1">
                                <!-- Теги активных фильтров будут добавляться динамически -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Счетчик выбранных элементов -->
                <div id="selectedItemsInfo" class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md hidden">
                    <div class="flex items-center">
                        <svg class="h-5 w-5 text-blue-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        <span id="selectedItemsCount" class="text-sm font-medium text-blue-800">0 элементов выбрано</span>
                        <button type="button" id="clearSelectionBtn" class="ml-4 text-sm text-blue-600 hover:text-blue-800 underline">
                            Очистить выбор
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table id="duplicatesTable" class="min-w-full divide-y divide-gray-200">
                        <!-- DataTables будет автоматически создавать заголовки -->
                    </table>
                </div>
                
                <!-- Заглушка для пустой таблицы -->
                <div id="duplicatesTableEmpty" class="text-center py-12 hidden">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">Нет данных</h3>
                    <p class="mt-1 text-sm text-gray-500">Объявления и объекты для обработки дублей не найдены</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно редактирования области -->
    <div id="editAreaModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white rounded-lg border text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg relative z-10">
                <form id="editAreaForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                <h3 class="text-lg leading-6 font-medium text-gray-900">
                                    Редактировать область
                                </h3>
                                <div class="mt-4 space-y-4">
                                    <div>
                                        <label for="editAreaName" class="block text-sm font-medium text-gray-700">Название области</label>
                                        <input type="text" name="name" id="editAreaName" required
                                               class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                    </div>

                                    <div>
                                        <label for="editAvitoUrl" class="block text-sm font-medium text-gray-700">URL фильтра Avito</label>
                                        <div class="mt-1 flex gap-2">
                                            <input type="url" name="avito_filter_url" id="editAvitoUrl"
                                                   class="flex-1 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            <button type="button" id="openAvitoBtn" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>
                                                <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                                </svg>
                                                Открыть Avito
                                            </button>
                                        </div>
                                    </div>

                                    <div>
                                        <label for="editCianUrl" class="block text-sm font-medium text-gray-700">URL фильтра Cian</label>
                                        <div class="mt-1 flex gap-2">
                                            <input type="url" name="cian_filter_url" id="editCianUrl"
                                                   class="flex-1 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            <button type="button" id="openCianBtn" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>
                                                <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                                </svg>
                                                Открыть Cian
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelEditArea" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно редактирования адреса -->
    <div id="editAddressModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="address-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full relative z-10">
                <form id="editAddressForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                <h3 id="address-modal-title" class="text-lg leading-6 font-medium text-gray-900">
                                    Редактировать адрес
                                </h3>
                                
                                <div class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <!-- Левая колонка - поля формы -->
                                    <div class="space-y-4">
                                        <div>
                                            <label for="editAddressText" class="block text-sm font-medium text-gray-700">Адрес</label>
                                            <input type="text" name="address" id="editAddressText" required
                                                   class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                        </div>

                                        <div>
                                            <label for="editAddressType" class="block text-sm font-medium text-gray-700">Тип</label>
                                            <select name="type" id="editAddressType" required
                                                    class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                                <option value="house">Дом</option>
                                                <option value="house_with_land">Дом с участком</option>
                                                <option value="land">Участок</option>
                                                <option value="commercial">Коммерция</option>
                                                <option value="building">Здание</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label for="editHouseSeries" class="block text-sm font-medium text-gray-700">Серия дома</label>
                                            <div class="flex gap-2">
                                                <select name="house_series_id" id="editHouseSeries"
                                                        class="mt-1 block flex-1 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                                    <option value="">Выберите серию...</option>
                                                </select>
                                                <button type="button" id="houseSeriesActionBtn" 
                                                        class="mt-1 inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                                    + Добавить
                                                </button>
                                            </div>
                                        </div>

                                        <div>
                                            <label for="editWallMaterial" class="block text-sm font-medium text-gray-700">Материал стен</label>
                                            <div class="flex gap-2">
                                                <select name="wall_material_id" id="editWallMaterial"
                                                        class="mt-1 block flex-1 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                                    <option value="">Выберите материал...</option>
                                                </select>
                                                <button type="button" id="wallMaterialActionBtn" 
                                                        class="mt-1 inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                                    + Добавить
                                                </button>
                                            </div>
                                        </div>

                                        <div>
                                            <label for="editCeilingMaterial" class="block text-sm font-medium text-gray-700">Материал перекрытий</label>
                                            <div class="flex gap-2">
                                                <select name="ceiling_material_id" id="editCeilingMaterial"
                                                        class="mt-1 block flex-1 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                                    <option value="">Выберите материал...</option>
                                                </select>
                                                <button type="button" id="ceilingMaterialActionBtn" 
                                                        class="mt-1 inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                                    + Добавить
                                                </button>
                                            </div>
                                        </div>

                                        <div>
                                            <label for="editGasSupply" class="block text-sm font-medium text-gray-700">Газоснабжение</label>
                                            <select name="gas_supply" id="editGasSupply"
                                                    class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                                <option value="">Не указано</option>
                                                <option value="true">Да</option>
                                                <option value="false">Нет</option>
                                            </select>
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label for="editFloorsCount" class="block text-sm font-medium text-gray-700">Этажей</label>
                                                <input type="number" name="floors_count" id="editFloorsCount" min="1"
                                                       class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            </div>
                                            <div>
                                                <label for="editBuildYear" class="block text-sm font-medium text-gray-700">Год постройки</label>
                                                <input type="number" name="build_year" id="editBuildYear" min="1800" max="2100"
                                                       class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label for="editEntrancesCount" class="block text-sm font-medium text-gray-700">Подъездов</label>
                                                <input type="number" name="entrances_count" id="editEntrancesCount" min="1"
                                                       class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            </div>
                                            <div>
                                                <label for="editLivingSpaces" class="block text-sm font-medium text-gray-700">Жилых помещений</label>
                                                <input type="number" name="living_spaces_count" id="editLivingSpaces" min="1"
                                                       class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            </div>
                                        </div>

                                        <div class="flex items-center space-x-6">
                                            <div class="flex items-center">
                                                <input id="editHasPlayground" name="has_playground" type="checkbox"
                                                       class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                                                <label for="editHasPlayground" class="ml-2 block text-sm text-gray-900">
                                                    Детская площадка
                                                </label>
                                            </div>
                                            <div class="flex items-center">
                                                <input id="editHasSportsArea" name="has_sports_area" type="checkbox"
                                                       class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                                                <label for="editHasSportsArea" class="ml-2 block text-sm text-gray-900">
                                                    Спортивная площадка
                                                </label>
                                            </div>
                                        </div>

                                    </div>
                                    
                                    <!-- Правая колонка - карта -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Местоположение на карте</label>
                                        <div id="editAddressMap" style="height: 400px; width: 100%;" class="border border-gray-300 rounded-md"></div>
                                        <p class="mt-2 text-sm text-gray-500">
                                            Перетащите маркер на карте для изменения координат
                                        </p>

                                        <!-- Блок ссылок на внешние сервисы -->
                                        <div class="mt-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-3">Просмотр на картах</label>
                                            <div class="grid grid-cols-1 gap-2 sm:grid-cols-3 sm:gap-3">
                                                <a id="url-2gis-address" href="#" target="_blank" class="inline-flex w-full justify-center rounded-md border border-gray-300 bg-green-100 px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-green-200">
                                                    2ГИС
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="ml-2 w-4 h-4">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path>
                                                    </svg>
                                                </a>
                                                <a id="url-yandex-address" href="#" target="_blank" class="inline-flex w-full justify-center rounded-md border border-gray-300 bg-red-100 px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-red-200">
                                                    Яндекс Карты
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="ml-2 w-4 h-4">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path>
                                                    </svg>
                                                </a>
                                                <a id="url-yandex-panorama-address" href="#" target="_blank" class="inline-flex w-full justify-center rounded-md border border-gray-300 bg-yellow-100 px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-yellow-200">
                                                    Панорамы
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="ml-2 w-4 h-4">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path>
                                                    </svg>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelEditAddress" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Уведомления -->
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-4">
        <!-- Уведомления будут добавляться динамически -->
    </div>

    <!-- Футер -->
    <div id="footer-container"></div>

    <!-- Скрипты -->
    <script src="../libs/jquery/jquery-3.7.1.min.js"></script>
    <script src="../libs/datatables/datatables.min.js"></script>
    <script src="../libs/slimselect/slimselect.min.js"></script>
    
    <!-- Leaflet JS -->
    <script src="../libs/leaflet/leaflet.js"></script>
    
    <!-- Leaflet Draw JS -->
    <script src="../libs/leaflet/leaflet.draw.js"></script>
    
    <!-- CSP-compliant Geo utilities -->
    <script src="../utils/lightweight-geo.js"></script>
    
    <!-- RBush for spatial indexing -->
    <script src="../libs/rbush/rbush.min.js"></script>
    
    <!-- OSM Overpass API utilities -->
    <script src="../utils/osm-overpass.js"></script>
    
    <script src="../components/navigation.js"></script>
    <script src="../components/breadcrumbs.js"></script>
    <script src="../components/footer.js"></script>
    <script src="../data/database.js"></script>
    <!-- Модальное окно добавления материала стен -->
    <div id="wallMaterialModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="wall-material-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md relative z-10">
                <form id="wallMaterialForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="w-full">
                                <h3 id="wall-material-modal-title" class="text-lg leading-6 font-medium text-gray-900 mb-4">
                                    Добавить материал стен
                                </h3>
                                
                                <input type="hidden" name="id" id="wallMaterialId">
                                <div class="space-y-4">
                                    <div>
                                        <label for="wallMaterialName" class="block text-sm font-medium text-gray-700">Название материала</label>
                                        <input type="text" name="name" id="wallMaterialName" required
                                               class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                               placeholder="Например: Газобетонный">
                                    </div>
                                    <div>
                                        <label for="wallMaterialColor" class="block text-sm font-medium text-gray-700">Цвет маркера</label>
                                        <div class="flex gap-2 items-center mt-1">
                                            <input type="color" name="color" id="wallMaterialColor" 
                                                   value="#3b82f6"
                                                   class="h-10 w-16 rounded-md bg-white outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 cursor-pointer">
                                            <span class="text-sm text-gray-500">Выберите цвет для маркеров на карте</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" id="saveWallMaterial" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelWallMaterial" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно добавления серии дома -->
    <div id="houseSeriesModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="house-series-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md relative z-10">
                <form id="houseSeriesForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="w-full">
                                <h3 id="house-series-modal-title" class="text-lg leading-6 font-medium text-gray-900 mb-4">
                                    Добавить серию дома
                                </h3>
                                
                                <input type="hidden" name="id" id="houseSeriesId">
                                <div>
                                    <label for="houseSeriesName" class="block text-sm font-medium text-gray-700">Название серии</label>
                                    <input type="text" name="name" id="houseSeriesName" required
                                           class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                           placeholder="Например: П-44Т">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" id="saveHouseSeries" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelHouseSeries" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно добавления материала перекрытий -->
    <div id="ceilingMaterialModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="ceiling-material-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md relative z-10">
                <form id="ceilingMaterialForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="w-full">
                                <h3 id="ceiling-material-modal-title" class="text-lg leading-6 font-medium text-gray-900 mb-4">
                                    Добавить материал перекрытий
                                </h3>
                                
                                <input type="hidden" name="id" id="ceilingMaterialId">
                                <div>
                                    <label for="ceilingMaterialName" class="block text-sm font-medium text-gray-700">Название материала</label>
                                    <input type="text" name="name" id="ceilingMaterialName" required
                                           class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                           placeholder="Например: Смешанное">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" id="saveCeilingMaterial" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelCeilingMaterial" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно просмотра объявления -->
    <div id="listingModal" class="fixed inset-0 z-50 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>

            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full relative z-10 max-h-[90vh]">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="w-full">
                            <!-- Заголовок -->
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                    Детали объявления
                                </h3>
                                <button type="button" id="closeModalBtn" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>

                            <!-- Содержимое -->
                            <div id="modalContent" class="max-h-[70vh] overflow-y-auto">
                                <!-- Контент будет загружен динамически -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="openListingBtn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Открыть объявление
                    </button>
                    <button type="button" id="closeModalBtn2" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Закрыть
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript библиотеки -->
    <script src="../libs/jquery/jquery-3.7.1.min.js"></script>
    <script src="../libs/datatables/datatables.min.js"></script>
    <script src="../libs/fotorama/fotorama.js"></script>
    <script src="../libs/apexcharts/apexcharts.js"></script>
    
    <!-- Сервисная архитектура -->
    <script src="../services/base/BaseAPIService.js"></script>
    <script src="../services/base/ServiceManager.js"></script>
    <script src="../services/external/InparsService.js"></script>
    <script src="../services/ui/InparsPanel.js"></script>
    <script src="../services/ServiceConfig.js"></script>
    
    <!-- Модели и утилиты -->
    <script src="../data/models.js"></script>
    <script src="../utils/geometry-utils.js"></script>
    <script src="../utils/geo-utils.js"></script>
    <script src="../utils/spatial-index-manager.js"></script>
    <script src="../utils/marker-cluster.js"></script>
    <script src="../utils/debug-logger.js"></script>
    
    <!-- Интеграция сервисов -->
    <script src="area_services_integration.js"></script>
    
    <!-- Страница (обновлен для использования сервисов) -->
    <script src="area.js"></script>
    <script src="area_init.js"></script>

</body>
</html>