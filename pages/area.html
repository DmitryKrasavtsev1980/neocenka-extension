<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neocenka - Управление областью</title>
    <link rel="stylesheet" href="../libs/tailwind/tailwind.min.css">
    <link rel="stylesheet" href="../libs/datatables/datatables.min.css">
    <link rel="stylesheet" href="../libs/slimselect/slimselect.css">
    <link rel="stylesheet" href="../libs/fotorama/fotorama.css">
    <link rel="stylesheet" href="../assets/styles/main.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="../libs/leaflet/leaflet.css">
    
    <!-- Leaflet Draw CSS -->
    <link rel="stylesheet" href="../libs/leaflet/leaflet.draw.css"/>
    
    <style>
        /* Стили для маркеров карты */
        .address-marker, .object-marker {
            border: none !important;
            background: transparent !important;
        }
        
        /* Специальные стили для корон и прямоугольников */
        .address-marker .marker-crown,
        .address-marker .marker-rectangle {
            background: inherit !important; /* Позволяем элементам иметь свой собственный background */
        }
        
        /* Стили для контроллера слоев */
        .leaflet-control-layers {
            background: rgba(255, 255, 255, 0.95) !important;
            border-radius: 6px !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) !important;
        }
        
        .leaflet-control-layers-list {
            margin: 8px !important;
        }
        
        .leaflet-control-layers label {
            font-size: 14px !important;
            padding: 4px 0 !important;
        }
        
        /* Popup стили */
        .leaflet-popup-content {
            margin: 8px 12px !important;
            line-height: 1.4 !important;
            max-width: 300px !important;
        }
        
        .leaflet-popup-content strong {
            font-weight: 600 !important;
        }
        
        /* Ограничение z-index для карты флиппинга, чтобы не перекрывать tooltip графиков */
        #flippingProfitabilityMap {
            z-index: 1 !important;
            position: relative !important;
        }
        
        #flippingProfitabilityMap .leaflet-map-pane,
        #flippingProfitabilityMap .leaflet-tile-pane,
        #flippingProfitabilityMap .leaflet-overlay-pane {
            z-index: 1 !important;
        }
        
        /* Повышение z-index для tooltip'ов ApexCharts */
        .apexcharts-tooltip {
            z-index: 9999 !important;
        }
        
        /* Скрываем легенду ApexCharts для графика коридора рынка */
        #marketCorridorChart .apexcharts-legend,
        #marketCorridorChart .apexcharts-legend-text,
        #flippingMarketCorridorChart .apexcharts-legend,
        #flippingMarketCorridorChart .apexcharts-legend-text {
            display: none !important;
        }


        .flipping-object-block .object-price {
            font-size: 14px !important;
            color: #059669 !important;
            font-weight: 600 !important;
        }

        .flipping-object-block .price-per-sqm {
            font-size: 9px !important;
            color: #10b981 !important;
            font-weight: 400 !important;
        }
        
        /* Стили для кластеров объявлений */
        .listing-cluster {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border: 3px solid #ffffff;
            border-radius: 50%;
            color: white;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 2px 10px rgba(59, 130, 246, 0.4);
        }

        /* Минимальные стили для SlimSelect категорий Inpars */
        #inparsCategoriesSelect .ss-main {
            min-height: 100px;
        }
        
        /* Выравнивание высоты фильтров обработки */
        .ss-main {
            min-height: 38px !important;
        }
        
        /* Исключение для категорий Inpars */
        #inparsCategoriesSelect + .ss-main {
            min-height: 100px !important;
        }
        
        .listing-cluster.small {
            width: 30px;
            height: 30px;
            line-height: 24px;
            font-size: 12px;
        }
        
        .listing-cluster.medium {
            width: 40px;
            height: 40px;
            line-height: 34px;
            font-size: 14px;
        }
        
        .listing-cluster.large {
            width: 50px;
            height: 50px;
            line-height: 44px;
            font-size: 16px;
        }
        
        /* Стили для попапов объявлений */
        .listing-popup, .address-popup {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .listing-popup .header {
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }
        
        .listing-popup .title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }
        
        .listing-popup .price {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .listing-popup .meta {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .listing-popup .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .listing-popup .status.active {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .listing-popup .status.archived {
            background-color: #f3f4f6;
            color: #374151;
        }
        
        
        .listing-popup .actions {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e5e7eb;
        }
        
        .listing-popup .btn {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            margin-right: 8px;
            transition: all 0.2s;
        }
        
        .listing-popup .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .listing-popup .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .listing-popup .btn-secondary {
            background-color: #f3f4f6;
            color: #374151;
        }
        
        .listing-popup .btn-secondary:hover {
            background-color: #e5e7eb;
        }

        /* Стили для popup адресов */
        .address-popup .header {
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }

        .address-popup .address-title {
            font-size: 14px;
            font-weight: 600;
            color: #111827;
            margin-top: 4px;
        }

        .address-popup .meta {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .address-popup .actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .address-popup .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 500;
            text-decoration: none;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .address-popup .btn-sm {
            padding: 6px 12px;
            font-size: 11px;
        }

        .address-popup .btn-primary {
            background-color: #3b82f6;
            color: white;
        }

        .address-popup .btn-primary:hover {
            background-color: #2563eb;
        }

        .address-popup .btn-danger {
            background-color: #ef4444;
            color: white;
        }

        .address-popup .btn-danger:hover {
            background-color: #dc2626;
        }

        /* Стили для сравнительного анализа */
        .comparative-analysis-wrapper {
            min-height: 400px;
        }

        .comparative-analysis-container {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .management-panel {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }

        .analysis-results-section {
            min-height: 500px;
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #e5e7eb;
        }

        .analysis-controls {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .btn-primary:hover {
            background-color: #2563eb;
            border-color: #2563eb;
        }

        .btn-secondary {
            background-color: #6b7280;
            color: white;
            border-color: #6b7280;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
            border-color: #4b5563;
        }

        .status-filter {
            display: flex;
            gap: 5px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }

        .filter-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .filter-btn:hover:not(.active) {
            background: #f3f4f6;
        }

        .objects-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-height: 360px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 10px;
        }

        .object-block {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 11px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: white;
        }

        .object-block:hover {
            border-color: #3b82f6;
            transform: translateY(-1px);
        }

        .object-block.selected {
            border-color: #1d4ed8;
            border-width: 3px;
            background: #dbeafe;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(29, 78, 216, 0.3);
        }

        .object-block.evaluated-better {
            background-color: #dbeafe;
            border-color: #93c5fd;
        }

        .object-block.evaluated-worse {
            background-color: #1e40af;
            color: white;
            border-color: #1d4ed8;
        }

        .object-block.evaluated-equal {
            background-color: #f3f4f6;
            border-color: #9ca3af;
        }

        .object-block.evaluated-excluded {
            background-color: #fca5a5;
            border-color: #dc2626;
            color: white;
        }

        .object-id {
            font-weight: 600;
        }

        .object-price {
            font-size: 10px;
            color: #059669;
            font-weight: 500;
        }

        .object-info {
            font-size: 9px;
            color: #6b7280;
        }

        .listings-panel {
            max-height: 120px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 10px;
        }

        .listings-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .listing-block {
            padding: 8px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
            background: white;
        }

        .listing-block:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .listing-block.selected {
            background: #eff6ff;
            border-color: #3b82f6;
        }

        .listing-details {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            max-height: 250px;
            overflow-y: auto;
            background: white;
        }

        .photos-gallery {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .photo-thumb {
            width: 60px;
            height: 45px;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            border: 1px solid #e5e7eb;
        }

        .photo-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-thumb:hover {
            border-color: #3b82f6;
        }

        .listing-description {
            font-size: 12px;
            line-height: 1.4;
            color: #4b5563;
            max-height: 120px;
            overflow-y: auto;
        }

        .evaluation-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .eval-btn {
            padding: 8px 12px;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 11px;
            transition: all 0.2s;
        }

        .eval-btn.exclude {
            background: #fef2f2;
            color: #dc2626;
            border-color: #fecaca;
        }

        .eval-btn.exclude:hover {
            background: #fee2e2;
            border-color: #fca5a5;
        }

        .eval-btn.worse {
            background: #1e40af;
            color: white;
            border-color: #1e40af;
        }

        .eval-btn.worse:hover {
            background: #1d4ed8;
            border-color: #1d4ed8;
        }

        .eval-btn.equal {
            background: #f3f4f6;
            color: #4b5563;
            border-color: #d1d5db;
        }

        .eval-btn.equal:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }

        .eval-btn.better {
            background: #dbeafe;
            color: #1d4ed8;
            border-color: #93c5fd;
        }

        .eval-btn.better:hover {
            background: #bfdbfe;
            border-color: #60a5fa;
        }

        .eval-btn.active {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            border-width: 3px;
            font-weight: 700;
            position: relative;
        }

        .eval-btn.active::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            pointer-events: none;
        }

        .chart-panel {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
        }

        .results-panel {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
        }

        .corridor-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .corridor-section {
            margin-bottom: 0;
        }

        .corridor-section.optimal {
            margin-top: 8px;
        }

        /* Стили для условной видимости полей в отчёте флиппинг */
        .conditional-field {
            display: none;
        }
        
        .conditional-field.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 200px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Навигация -->
    <div id="navigation-container"></div>

    <!-- Скрытый контент для переноса -->
    <div id="area-content" class="hidden max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Хлебные крошки -->
        <div id="breadcrumbs-container"></div>

        <!-- Заголовок области -->
        <div class="px-4 py-5 border-b border-gray-200 sm:px-6">
            <div class="flex items-center justify-between">
                <div>
                    <h2 id="areaTitle" class="text-lg leading-6 font-medium text-gray-900">Загрузка...</h2>
                    <p class="mt-1 max-w-2xl text-sm text-gray-500" id="areaDescription">
                        Управление областью на карте, адресами и обработкой данных
                    </p>
                </div>
                <div class="flex space-x-3">
                     <!-- Редактирование области -->
                    <button type="button" id="editAreaBtn" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        Редактировать
                    </button>
                    <!-- Панель скрытия панелей на странице -->
                    <div class="relative inline-block text-left">
                        <div>
                            <button type="button" id="panelBtn" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" aria-expanded="true" aria-haspopup="true">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
                                </svg>
                            </button>
                        </div>
                        <div id="panelDropdown" class="hidden absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-hidden" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                            <label class="group flex items-center text-nowrap px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                <input type="checkbox" id="statisticsPanel" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="mr-3 size-5 text-gray-400">
                                <path d="M15.5 2A1.5 1.5 0 0 0 14 3.5v13a1.5 1.5 0 0 0 1.5 1.5h1a1.5 1.5 0 0 0 1.5-1.5v-13A1.5 1.5 0 0 0 16.5 2h-1ZM9.5 6A1.5 1.5 0 0 0 8 7.5v9A1.5 1.5 0 0 0 9.5 18h1a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 10.5 6h-1ZM3.5 10A1.5 1.5 0 0 0 2 11.5v5A1.5 1.5 0 0 0 3.5 18h1A1.5 1.5 0 0 0 6 16.5v-5A1.5 1.5 0 0 0 4.5 10h-1Z" />
                                </svg>
                                Статистика области
                            </label>
                            <label class="group flex items-center text-nowrap px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                <input type="checkbox" id="dataWorkPanel" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="mr-3 size-5 text-gray-400">
                                <path d="M2 4.5A2.5 2.5 0 0 1 4.5 2h11a2.5 2.5 0 0 1 0 5h-11A2.5 2.5 0 0 1 2 4.5ZM2.75 9.083a.75.75 0 0 0 0 1.5h14.5a.75.75 0 0 0 0-1.5H2.75ZM2.75 12.663a.75.75 0 0 0 0 1.5h14.5a.75.75 0 0 0 0-1.5H2.75ZM2.75 16.25a.75.75 0 0 0 0 1.5h14.5a.75.75 0 1 0 0-1.5H2.75Z" />
                                </svg>
                                Работа с данными
                            </label>
                            <label class="group flex items-center text-nowrap px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                <input type="checkbox" id="mapPanel" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="mr-3 size-5 text-gray-400">
                                <path fill-rule="evenodd" d="M8.157 2.176a1.5 1.5 0 0 0-1.147 0l-4.084 1.69A1.5 1.5 0 0 0 2 5.25v10.877a1.5 1.5 0 0 0 2.074 1.386l3.51-1.452 4.26 1.762a1.5 1.5 0 0 0 1.146 0l4.083-1.69A1.5 1.5 0 0 0 18 14.75V3.872a1.5 1.5 0 0 0-2.073-1.386l-3.51 1.452-4.26-1.762ZM7.58 5a.75.75 0 0 1 .75.75v6.5a.75.75 0 0 1-1.5 0v-6.5A.75.75 0 0 1 7.58 5Zm5.59 2.75a.75.75 0 0 0-1.5 0v6.5a.75.75 0 0 0 1.5 0v-6.5Z" clip-rule="evenodd" />
                                </svg>
                                Карта области
                            </label>
                            <label class="group flex items-center text-nowrap px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                <input type="checkbox" id="addressesPanel" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="mr-3 size-5 text-gray-400">
                                <path fill-rule="evenodd" d="m9.69 18.933.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 0 0 .281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 1 0 3 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 0 0 2.273 1.765 11.842 11.842 0 0 0 .976.544l.062.029.018.008.006.003ZM10 11.25a2.25 2.25 0 1 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z" clip-rule="evenodd" />
                                </svg>
                                Таблица адресов
                            </label>
                            <label class="group flex items-center text-nowrap px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                <input type="checkbox" id="segmentsPanel" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="mr-3 size-5 text-gray-400">
                                <path d="M12 9a1 1 0 0 1-1-1V3c0-.552.45-1.007.997-.93a7.004 7.004 0 0 1 5.933 5.933c.078.547-.378.997-.93.997h-5Z" />
                                <path d="M8.003 4.07C8.55 3.994 9 4.449 9 5v5a1 1 0 0 0 1 1h5c.552 0 1.008.45.93.997A7.001 7.001 0 0 1 2 11a7.002 7.002 0 0 1 6.003-6.93Z" />
                                </svg>
                                Сегменты
                            </label>
                            <label class="group flex items-center text-nowrap px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                <input type="checkbox" id="reportsPanel" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="mr-3 size-5 text-gray-400">
                                    <path fill-rule="evenodd" d="M1 2.75A.75.75 0 0 1 1.75 2h16.5a.75.75 0 0 1 0 1.5H18v8.75A2.75 2.75 0 0 1 15.25 15h-1.072l.798 3.06a.75.75 0 0 1-1.452.38L13.41 18H6.59l-.114.44a.75.75 0 0 1-1.452-.38L5.823 15H4.75A2.75 2.75 0 0 1 2 12.25V3.5h-.25A.75.75 0 0 1 1 2.75ZM7.373 15l-.391 1.5h6.037l-.392-1.5H7.373Zm7.49-8.931a.75.75 0 0 1-.175 1.046 19.326 19.326 0 0 0-3.398 3.098.75.75 0 0 1-1.097.04L8.5 8.561l-2.22 2.22A.75.75 0 1 1 5.22 9.72l2.75-2.75a.75.75 0 0 1 1.06 0l1.664 1.663a20.786 20.786 0 0 1 3.122-2.74.75.75 0 0 1 1.046.176Z" clip-rule="evenodd" />
                                </svg>
                                Отчёты
                            </label>
                            <label class="group flex items-center text-nowrap px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                <input type="checkbox" id="duplicatesPanel" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="mr-3 size-5 text-gray-400">
                                <path fill-rule="evenodd" d="M6 4.75A.75.75 0 0 1 6.75 4h10.5a.75.75 0 0 1 0 1.5H6.75A.75.75 0 0 1 6 4.75ZM6 10a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H6.75A.75.75 0 0 1 6 10Zm0 5.25a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H6.75a.75.75 0 0 1-.75-.75ZM1.99 4.75a1 1 0 0 1 1-1H3a1 1 0 0 1 1 1v.01a1 1 0 0 1-1 1h-.01a1 1 0 0 1-1-1v-.01ZM1.99 15.25a1 1 0 0 1 1-1H3a1 1 0 0 1 1 1v.01a1 1 0 0 1-1 1h-.01a1 1 0 0 1-1-1v-.01ZM1.99 10a1 1 0 0 1 1-1H3a1 1 0 0 1 1 1v.01a1 1 0 0 1-1 1h-.01a1 1 0 0 1-1-1V10Z" clip-rule="evenodd" />
                                </svg>
                                Управление дублями
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Статистика области (сворачиваемая панель) -->
        <div id="statisticsPanelContainer" class="mt-6">
            <div class="bg-white shadow overflow-hidden sm:rounded-md">
                <div class="px-4 py-5 sm:px-6 cursor-pointer" id="statisticsPanelHeader">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Статистика области</h3>
                            <p class="mt-1 text-sm text-gray-500">Общая информация и аналитика по области</p>
                        </div>
                        <svg id="statisticsPanelChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
                
                <div id="statisticsPanelContent" class="hidden">
                    <div class="px-4 py-5 sm:p-6">
                        <!-- Счетчики статистики -->
                        <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-6">
                            <div class="bg-gray-50 overflow-hidden shadow-sm rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Площадь</dt>
                                                <dd id="segmentsCount" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-50 overflow-hidden shadow-sm rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Адресов</dt>
                                                <dd id="addressesCount" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-50 overflow-hidden shadow-sm rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Объектов</dt>
                                                <dd id="objectsCount" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-50 overflow-hidden shadow-sm rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Объявлений</dt>
                                                <dd id="listingsCount" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- График источников объявлений -->
                        <div class="bg-gray-50 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">Источники объявлений</h4>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- График -->
                                <div class="bg-white rounded-lg p-4">
                                    <div id="sourcesChart" class="w-full h-80"></div>
                                </div>
                                <!-- Таблица с данными -->
                                <div class="bg-white rounded-lg p-4">
                                    <h5 class="text-md font-medium text-gray-900 mb-3">Детализация</h5>
                                    <div id="sourcesTable" class="space-y-2">
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-600">Загрузка данных...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Аналитика определения адресов -->
                        <div class="bg-gray-50 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">Определение адресов</h4>
                            <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                                <!-- График точности определения -->
                                <div class="bg-white rounded-lg p-4">
                                    <h5 class="text-md font-medium text-gray-900 mb-3">Точность определения</h5>
                                    <div id="addressConfidenceChart" class="w-full h-64"></div>
                                </div>
                                
                                <!-- График методов определения -->
                                <div class="bg-white rounded-lg p-4">
                                    <h5 class="text-md font-medium text-gray-900 mb-3">Методы определения</h5>
                                    <div id="addressMethodsChart" class="w-full h-64"></div>
                                </div>
                                
                                <!-- Статистика и детализация -->
                                <div class="bg-white rounded-lg p-4">
                                    <h5 class="text-md font-medium text-gray-900 mb-3">Статистика</h5>
                                    <div id="addressStatsTable" class="space-y-3">
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-600">Загрузка данных...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Статистика обработки дублей -->
                        <div class="bg-gray-50 rounded-lg p-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">Обработка дублей</h4>
                            
                            <!-- Счетчики обработки дублей -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                <div class="bg-white rounded-lg p-4 shadow-sm">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-3 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Требуют обработки</dt>
                                                <dd id="duplicatesNeedProcessing" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg p-4 shadow-sm">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-3 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Обработано</dt>
                                                <dd id="duplicatesProcessed" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg p-4 shadow-sm">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-3 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Объединено</dt>
                                                <dd id="duplicatesMerged" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg p-4 shadow-sm">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-6 w-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-3 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Эффективность</dt>
                                                <dd id="duplicatesEfficiency" class="text-lg font-medium text-gray-900">-</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                                <!-- График статусов обработки -->
                                <div class="bg-white rounded-lg p-4">
                                    <h5 class="text-md font-medium text-gray-900 mb-3">Статусы обработки</h5>
                                    <div id="duplicatesStatusChart" class="w-full h-64"></div>
                                </div>
                                
                                <!-- Статистика точности объединения -->
                                <div class="bg-white rounded-lg p-4">
                                    <h5 class="text-md font-medium text-gray-900 mb-3">Точность объединения</h5>
                                    <div id="duplicatesAccuracyStats" class="space-y-3">
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-600">Загрузка данных...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Панель работы с данными -->
        <div id="dataWorkPanelContainer" class="mt-8">
            <div class="bg-white shadow overflow-hidden sm:rounded-md">
                <div class="px-4 py-5 sm:px-6 cursor-pointer" id="dataWorkPanelHeader">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Работа с данными</h3>
                            <p class="mt-1 text-sm text-gray-500">Импорт, обработка и анализ данных недвижимости</p>
                        </div>
                        <svg id="dataWorkPanelChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
                <div id="dataWorkPanelContent" class="px-4 pb-5 hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                        <!-- Навигация -->
                        <div class="lg:col-span-1">
                            <nav class="flex flex-1 flex-col" aria-label="Data work navigation">
                                <ul role="list" class="-mx-2 space-y-1">
                                    <li>
                                        <a href="#" data-tab="import-addresses" class="data-nav-item group flex gap-x-3 rounded-md bg-indigo-50 p-2 pl-3 text-sm font-semibold text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            </svg>
                                            Импорт/экспорт адресов
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="import-listings" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                                            </svg>
                                            Импорт объявлений
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="parse-listings" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                            </svg>
                                            Парсинг объявлений
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="update-listings" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                            </svg>
                                            Обновление объявлений
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="identify-addresses" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                                            </svg>
                                            Определение адресов
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="process-duplicates" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                            </svg>
                                            Обработка на дубли
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" data-tab="delete-data" class="data-nav-item group flex gap-x-3 rounded-md p-2 pl-3 text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                            <svg class="h-5 w-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H8a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                            Удаление данных
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                        
                        <!-- Контент -->
                        <div class="lg:col-span-3">
                            <!-- Импорт адресов -->
                            <div id="content-import-addresses" class="data-content-tab">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Импорт/экспорт адресов</h4>
                                    <p class="text-sm text-gray-600 mb-4">Загрузка адресов объектов недвижимости из внешних источников</p>
                                    
                                    <!-- Импорт из OSM -->
                                    <button type="button" id="loadAddressesBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700 disabled:opacity-50 disabled:cursor-not-allowed">
                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                        </svg>
                                        Загрузить адреса из OSM
                                    </button>

                                    <!-- Панель импорта/экспорта из файла -->
                                    <div class="mt-6 pt-6 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-4">Импорт/экспорт адресов из файла</h5>
                                        
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <!-- Экспорт адресов -->
                                            <div class="space-y-3">
                                                <label class="block text-sm font-medium text-gray-700">Экспорт адресов</label>
                                                <div class="relative">
                                                    <button type="button" id="exportAddressesBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed">
                                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                        </svg>
                                                        Экспорт в файл
                                                    </button>
                                                </div>
                                                <p class="text-xs text-gray-500">Сохранить адреса области в JSON файл</p>
                                            </div>
                                            
                                            <!-- Импорт адресов -->
                                            <div class="space-y-3">
                                                <label class="block text-sm font-medium text-gray-700">Импорт адресов</label>
                                                <div class="relative">
                                                    <input type="file" id="importAddressesFile" accept=".json" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                                                    <button type="button" id="importAddressesBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                                                        </svg>
                                                        Выбрать файл
                                                    </button>
                                                </div>
                                                <p class="text-xs text-gray-500">Загрузить адреса из JSON файла</p>
                                            </div>
                                        </div>
                                        
                                        <!-- Статус операций с файлами -->
                                        <div id="fileOperationStatus" class="mt-4 text-sm text-gray-600 hidden"></div>
                                    </div>

                                    <!-- Импорт из GeoJSON Реформа ЖКХ -->
                                    <div class="mt-6 pt-6 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-4">Импорт из GeoJSON "Реформа ЖКХ"</h5>
                                        <p class="text-xs text-gray-500 mb-4">Импорт адресов домов из файлов системы "Реформа ЖКХ" в формате GeoJSON</p>
                                        
                                        <div class="grid grid-cols-1 gap-4">
                                            <!-- Выбор файла -->
                                            <div class="space-y-3">
                                                <label class="block text-sm font-medium text-gray-700">Выберите GeoJSON файл:</label>
                                                <div class="relative">
                                                    <input type="file" id="geojsonFile" accept=".geojson,.json" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                                                    <button type="button" id="selectGeoJsonBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                        </svg>
                                                        Выбрать GeoJSON файл
                                                    </button>
                                                </div>
                                                <div id="selectedFileName" class="text-xs text-gray-500 hidden"></div>
                                            </div>
                                            
                                            <!-- Настройки импорта -->
                                            <div class="bg-gray-50 p-3 rounded-md">
                                                <h6 class="text-xs font-medium text-gray-700 mb-2">Настройки импорта:</h6>
                                                <div class="space-y-2">
                                                    <div class="flex items-center">
                                                        <input type="checkbox" id="createReferences" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" checked>
                                                        <label for="createReferences" class="ml-2 block text-xs text-gray-700">Создавать записи в справочниках</label>
                                                    </div>
                                                    <div class="text-xs text-gray-500 mt-2">
                                                        ℹ️ Дубли автоматически пропускаются при точном совпадении адреса и координат (в радиусе 10м)
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            
                                            <!-- Кнопки импорта -->
                                            <div class="flex gap-2">
                                                <button type="button" id="startGeoJsonImport" class="flex-1 inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                                    <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                                    </svg>
                                                    <span id="importButtonText">Начать импорт из GeoJSON</span>
                                                </button>
                                                <button type="button" id="stopGeoJsonImport" class="inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed hidden">
                                                    <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10h6v4H9z"></path>
                                                    </svg>
                                                    Стоп
                                                </button>
                                            </div>
                                            
                                            <!-- Результаты импорта -->
                                            <div id="geojsonImportResults" class="hidden">
                                                <!-- Результаты будут добавлены динамически -->
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Прогресс загрузки адресов -->
                                    <div class="mt-6 pt-6 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс загрузки</h5>
                                        <div class="space-y-1" data-progress="import-addresses">
                                            <div class="flex justify-between text-xs text-gray-500">
                                                <span>Загрузка адресов</span>
                                                <span id="import-addressesProgress">0%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="import-addressesProgressBar" class="bg-sky-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                            </div>
                                            <div id="import-addressesStatus" class="text-xs text-gray-500 hidden"></div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            
                            <!-- Импорт объявлений -->
                            <div id="content-import-listings" class="data-content-tab hidden">
                                <div id="inparsPanelContainer">
                                    <!-- Панель Inpars будет добавлена динамически через JavaScript -->
                                </div>
                            </div>
                            
                            <!-- Парсинг объявлений -->
                            <div id="content-parse-listings" class="data-content-tab hidden">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Парсинг объявлений</h4>
                                    <p class="text-sm text-gray-600 mb-4">Автоматический сбор объявлений с сайтов недвижимости по фильтрам области</p>
                                    
                                    <button type="button" id="parseListingsBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700">
                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                        </svg>
                                        Парсить объявления
                                    </button>

                                    <!-- Прогресс парсинга -->
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс парсинга</h5>
                                        <div class="space-y-1" data-progress="parsing">
                                            <div class="flex justify-between text-xs text-gray-500">
                                                <span>Парсинг объявлений</span>
                                                <span id="parsingProgress">0%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="parsingProgressBar" class="bg-sky-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                            </div>
                                            <div id="parsingStatus" class="text-xs text-gray-500 hidden"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Обновление объявлений -->
                            <div id="content-update-listings" class="data-content-tab hidden">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Обновление объявлений</h4>
                                    <p class="text-sm text-gray-600 mb-4">Обновление данных по существующим объявлениям</p>
                                    
                                    <button type="button" id="updateListingsBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700">
                                        <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                        Обновить объявления
                                    </button>

                                    <!-- Прогресс обновления -->
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс обновления</h5>
                                        <div class="space-y-1" data-progress="updating">
                                            <div class="flex justify-between text-xs text-gray-500">
                                                <span>Обновление объявлений</span>
                                                <span id="updatingProgress">0%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="updatingProgressBar" class="bg-sky-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                            </div>
                                            <div id="updatingStatus" class="text-xs text-gray-500 hidden"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Определение адресов -->
                            <div id="content-identify-addresses" class="data-content-tab hidden">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Определение адресов</h4>
                                    <p class="text-sm text-gray-600 mb-4">Автоматическое определение адресов для объявлений</p>
                                    
                                    <div class="space-y-3">
                                        
                                        <button type="button" id="processAddressesSmartBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700">
                                            <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                            </svg>
                                            Определить адреса
                                        </button>
                                        
                                        <!-- <button type="button" id="analyzeUnresolvedAddressesBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600">
                                            <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                                            </svg>
                                            🔬 Дополнительный анализ адресов
                                        </button> -->
                                    </div>
                                    
                                    <!-- <div class="bg-purple-50 border border-purple-200 rounded-lg p-3 mt-4">
                                        <h5 class="text-sm font-medium text-purple-900 mb-2">Умный ML-алгоритм</h5>
                                        <p class="text-xs text-purple-700">
                                            🧠 Машинное обучение для ранжирования<br>
                                            🎯 Адаптивные пороги и веса<br>
                                            🔧 Нечеткая логика и семантика<br>
                                            ⚡ Кэширование и самообучение<br>
                                            📊 Композитный скоринг с 5 алгоритмами
                                        </p>
                                    </div>
                                    
                                    <div class="bg-cyan-50 border border-cyan-200 rounded-lg p-3 mt-4">
                                        <h5 class="text-sm font-medium text-cyan-900 mb-2">🔬 Анализ неопределенных адресов</h5>
                                        <p class="text-xs text-cyan-700">
                                            🔍 Находит объявления с низким уровнем точности определения адреса<br>
                                            🧩 Группирует по схожести названий и координат<br>
                                            🏗️ Создает новые адреса из групп объявлений<br>
                                            📊 Анализирует этажность и характеристики<br>
                                            🎯 Автоматически привязывает объявления к адресам<br>
                                            📈 Мин. 10 объявлений в группе, радиус 30м
                                        </p>
                                    </div> -->

                                    <!-- Прогресс обработки адресов -->
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс обработки</h5>
                                        <div id="addressesProgress" class="hidden">
                                            <div class="mb-2">
                                                <div class="progress-text text-sm text-gray-600"></div>
                                                <div class="progress-percentage text-sm font-medium text-gray-900"></div>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div class="progress-bar bg-blue-600 h-2 rounded-full transition-all duration-300" 
                                                     style="width: 0%" 
                                                     role="progressbar" 
                                                     aria-valuenow="0" 
                                                     aria-valuemin="0" 
                                                     aria-valuemax="100">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Обработка на дубли -->
                            <div id="content-process-duplicates" class="data-content-tab hidden">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Обработка на дубли</h4>
                                    <p class="text-sm text-gray-600 mb-4">Поиск и обработка дублирующихся объявлений</p>
                                    
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                                        <h5 class="text-sm font-medium text-blue-900 mb-2">Продвинутый алгоритм</h5>
                                        <p class="text-xs text-blue-700">
                                            ✨ Анализ уникальных характеристик (сауна, хамам, планировка)<br>
                                            🏠 Интеллектуальное сравнение спецификаций<br>
                                            👥 Анализ связей между продавцами<br>
                                            💰 Сопоставление ценовой динамики<br>
                                            🧠 Кластеризация с матрицей сходства
                                        </p>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <button type="button" id="processDuplicatesBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700">
                                            <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                            </svg>
                                            Обработать дубли (стандартный)
                                        </button>
                                        
                                        <button type="button" id="processDuplicatesAdvancedBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700">
                                            <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                            </svg>
                                            Продвинутая обработка дублей
                                        </button>
                                    </div>

                                    <!-- Прогресс обработки дублей -->
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс обработки</h5>
                                        <div class="space-y-1" data-progress="duplicates">
                                            <div class="flex justify-between text-xs text-gray-500">
                                                <span>Обработка дублей</span>
                                                <span id="duplicatesProgress">0%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="duplicatesProgressBar" class="bg-sky-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                            </div>
                                            <div id="duplicatesStatus" class="text-xs text-gray-500 hidden"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Удаление данных -->
                            <div id="content-delete-data" class="data-content-tab hidden">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Удаление данных области</h4>
                                    <p class="text-sm text-gray-600 mb-4">Удаление различных типов данных из выбранной области</p>
                                    
                                    <div class="space-y-4">
                                        <!-- Удаление объявлений -->
                                        <button type="button" id="deleteDataBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700 disabled:opacity-50 disabled:cursor-not-allowed">
                                            <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                            Удалить объявления области
                                        </button>
                                        
                                        <!-- Удаление всех адресов -->
                                        <button type="button" id="deleteAllAddressesBtn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed">
                                            <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            </svg>
                                            Удалить все адреса области
                                        </button>
                                    </div>

                                    <!-- Прогресс удаления -->
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <h5 class="text-sm font-medium text-gray-900 mb-3">Прогресс удаления</h5>
                                        <div class="space-y-1" data-progress="delete-data">
                                            <div class="flex justify-between text-xs text-gray-500">
                                                <span>Удаление объявлений</span>
                                                <span id="delete-dataProgress">0%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="delete-dataProgressBar" class="bg-sky-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                            </div>
                                            <div id="delete-dataStatus" class="text-xs text-gray-500 hidden"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Карта -->
        <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Карта -->
            <div id="mapPanelContainer" class="col-span-1 lg:col-span-3">
                <div class="bg-white shadow overflow-hidden sm:rounded-md">
                    <div class="px-4 py-5 sm:px-6 cursor-pointer" id="mapPanelHeader">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg leading-6 font-medium text-gray-900">Карта области</h3>
                                <p class="mt-1 text-sm text-gray-500">Интерактивная карта с адресами, объектами и объявлениями</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <svg id="mapPanelChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div id="mapPanelContent" class="px-4 pb-5 hidden">
                        <div class="mb-3 flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <!-- Кнопки фильтров над картой -->
                                <div class="flex flex-wrap items-center gap-2">
                                    <button type="button" id="filterByYear" data-filter="year" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Год
                                    </button>
                                    <button type="button" id="filterBySeries" data-filter="series" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Серия
                                    </button>
                                    <button type="button" id="filterByFloors" data-filter="floors" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Этажность
                                    </button>
                                    <button type="button" id="filterByObjects" data-filter="objects" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Объектов
                                    </button>
                                    <button type="button" id="filterByListings" data-filter="listings" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        </svg>
                                        Объявлений
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <button type="button" id="refreshMapBtn" class="inline-flex items-center px-3 py-2 border border-gray-300 text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                    <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Обновить карту
                                </button>
                            </div>
                        </div>
                        <div id="map" style="height: 500px; width: 100%;z-index:0;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Таблица адресов -->
        <div id="addressTableContainer" class="mt-8 bg-white shadow overflow-hidden sm:rounded-md">
            <div class="px-4 py-5 sm:px-6 cursor-pointer" id="addressTableHeader">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Таблица адресов</h3>
                        <p class="mt-1 text-sm text-gray-500">Адреса в области с привязкой к объектам недвижимости</p>
                    </div>
                    <svg id="addressTableChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </div>
            </div>
            <div id="addressTableContent" class="space-y-4 hidden">
                <div class="px-4 pb-2 flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <label class="text-sm font-medium text-gray-700">Фильтр по источнику:</label>
                        <div id="sourceFilter"></div>
                    </div>
                    <button type="button" id="addAddressBtn" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200">
                        <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Добавить адрес
                    </button>
                </div>
                <div class="px-4 pb-5">
                    <table id="addressesTable" class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Источник</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Адрес</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Тип</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Конструктив</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Объектов</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Объявлений</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <!-- Данные будут загружены через JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Сегменты (сворачиваемая панель) -->
        <div id="segmentsPanelContainer" class="mt-8">
            <div class="bg-white shadow overflow-hidden sm:rounded-md">
                <div class="px-4 py-5 sm:px-6 cursor-pointer" id="segmentsPanelHeader">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Сегменты</h3>
                            <p class="mt-1 text-sm text-gray-500">Управление сегментами и подсегментами области</p>
                        </div>
                        <svg id="segmentsPanelChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
                <div id="segmentsPanelContent" class="px-4 pb-5 space-y-6 hidden">
                    
                    <!-- Кнопка создания сегмента -->
                    <div class="flex items-center justify-between">
                        <h4 class="text-md font-medium text-gray-900">Сегменты области</h4>
                        <button type="button" id="createSegmentBtn" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            Создать сегмент
                        </button>
                    </div>

                    <!-- Таблица сегментов -->
                    <div class="overflow-x-auto">
                        <table id="segmentsTable" class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Название</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Количество домов</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Подсегменты</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <!-- Данные будут добавлены через DataTables -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Заглушка для пустой таблицы -->
                    <div id="segmentsTableEmpty" class="text-center py-12 hidden">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                        </svg>
                        <h3 class="mt-2 text-sm font-medium text-gray-900">Нет сегментов</h3>
                        <p class="mt-1 text-sm text-gray-500">Создайте первый сегмент для этой области</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Отчёты (сворачиваемая панель) -->
        <div id="reportsPanelContainer" class="mt-8">
            <div class="bg-white shadow overflow-hidden sm:rounded-md">
                <div class="px-4 py-5 sm:px-6 cursor-pointer" id="reportsPanelHeader">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Отчёты</h3>
                            <p class="mt-1 text-sm text-gray-500">Аналитические отчёты по ликвидности и ценам недвижимости</p>
                        </div>
                        <svg id="reportsPanelChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
                <div id="reportsPanelContent" class="px-4 pb-5 space-y-6 hidden">
                    
                    <!-- Фильтр отчётов -->
                    <div class="bg-gray-50 p-4 rounded-lg space-y-4">
                        <div class="flex items-center justify-between">
                            <h4 class="text-md font-medium text-gray-900">Фильтр отчётов</h4>
                            <div class="relative">
                                <button type="button" id="reportsDropdownBtn" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                    </svg>
                                    Отчёты
                                    <svg class="ml-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div id="reportsDropdown" class="absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-10 border border-gray-200 hidden">
                                    <div class="py-1">
                                        <label class="group flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                            <input type="checkbox" id="liquidityReportCheck" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <svg class="mr-2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                            </svg>
                                            Ликвидность
                                        </label>
                                        <label class="group flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                            <input type="checkbox" id="priceChangesReportCheck" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <svg class="mr-2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                                            </svg>
                                            Изменение средней цены
                                        </label>
                                        <label class="group flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                            <input type="checkbox" id="marketCorridorReportCheck" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <svg class="mr-2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                            </svg>
                                            Коридор рынка недвижимости
                                        </label>
                                        <label class="group flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                            <input type="checkbox" id="comparativeAnalysisReportCheck" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <svg class="mr-2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v6a2 2 0 002 2h2m0 0h4m0 0h2a2 2 0 002-2V7a2 2 0 00-2-2h-2m-4 8v2m0-2v-2m0 2h.01"></path>
                                            </svg>
                                            Сравнительный анализ
                                        </label>
                                        <label class="group flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
                                            <input type="checkbox" id="flippingProfitabilityReportCheck" class="mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <svg class="mr-2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            Доходность флиппинг
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Основные фильтры отчётов -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <!-- Фильтр по сегменту -->
                            <div>
                                <label for="reportsSegmentFilter" class="block text-xs font-medium text-gray-700 mb-1">Сегмент</label>
                                <select id="reportsSegmentFilter">
                                    <!-- Опции будут загружены динамически -->
                                </select>
                            </div>

                            <!-- Фильтр по подсегменту -->
                            <div>
                                <label for="reportsSubsegmentFilter" class="block text-xs font-medium text-gray-700 mb-1">Подсегмент</label>
                                <select id="reportsSubsegmentFilter" disabled>
                                    <option value="">Весь сегмент</option>
                                    <!-- Опции будут загружены динамически -->
                                </select>
                            </div>

                            <!-- Период от -->
                            <div>
                                <label for="reportsDateFrom" class="block text-xs font-medium text-gray-700 mb-1">Период от</label>
                                <input type="date" id="reportsDateFrom" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>

                            <!-- Период до -->
                            <div>
                                <label for="reportsDateTo" class="block text-xs font-medium text-gray-700 mb-1">Период до</label>
                                <input type="date" id="reportsDateTo" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                        </div>

                        <!-- Управление шаблонами фильтров -->
                        <div class="mb-4 p-3 bg-blue-50 rounded-md border border-blue-200">
                            <div class="mb-2">
                                <h5 class="text-sm font-medium text-blue-900">💾 Сохранение и загрузка настроек фильтров</h5>
                                <p class="text-xs text-blue-700 mt-1">Сохраните текущие настройки фильтров как шаблон для быстрого повторного использования</p>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                                <!-- Выбор сохранённого фильтра -->
                                <div>
                                    <label for="reportFilterSelect" class="block text-xs font-medium text-gray-700 mb-1">Загрузить шаблон</label>
                                    <select id="reportFilterSelect">
                                        <option value="">Создать новый шаблон</option>
                                        <!-- Опции будут загружены динамически -->
                                    </select>
                                </div>
                                
                                <!-- Название фильтра -->
                                <div>
                                    <label for="reportFilterName" class="block text-xs font-medium text-gray-700 mb-1">Название шаблона *</label>
                                    <input type="text" id="reportFilterName" required
                                           class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder:text-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                           placeholder="Введите название для сохранения">
                                    <input type="hidden" id="reportFilterId">
                                </div>
                            </div>
                            
                            <!-- Кнопки управления шаблонами -->
                            <div class="flex items-center justify-end space-x-2">
                                <button type="button" id="saveReportFilterBtn" class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" title="Сохранить текущие настройки как шаблон для многократного использования">
                                    💾 Сохранить шаблон
                                </button>
                                <button type="button" id="deleteReportFilterBtn" class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled title="Удалить выбранный шаблон">
                                    🗑️ Удалить шаблон
                                </button>
                            </div>
                            
                            <!-- Индикатор несохранённых изменений -->
                            <div id="unsavedChangesIndicator" class="hidden mt-2 p-2 bg-orange-50 border border-orange-200 rounded-md">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <svg class="h-4 w-4 text-orange-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-2">
                                        <p class="text-sm text-orange-700">
                                            <strong>Есть несохранённые изменения</strong> в настройках фильтров или сравнительном анализе
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Таблица шаблонов фильтров -->
                        <div class="mb-4">
                            <div class="mb-3">
                                <h4 class="text-sm font-medium text-gray-700">📋 Сохранённые шаблоны фильтров</h4>
                                <p class="text-xs text-gray-600 mt-1">Управление сохранёнными настройками фильтров</p>
                            </div>
                            <div class="datatables-container">
                                <!-- Лоадер для таблицы шаблонов -->
                                <div id="filterTemplatesLoader" class="flex items-center justify-center p-8 bg-gray-50 rounded-md border border-gray-200">
                                    <div class="flex items-center space-x-3">
                                        <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
                                        <span class="text-sm text-gray-600">Загрузка шаблонов фильтров...</span>
                                    </div>
                                </div>
                                <table class="display nowrap" id="filterTemplatesTable" style="width:100%; display:none;">
                                    <thead>
                                        <tr>
                                            <th>Название</th>
                                            <th>Сегмент</th>
                                            <th>Подсегмент</th>
                                            <th>Период</th>
                                            <th>Отчёты</th>
                                            <th>Создан</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Данные загружаются динамически -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Сохранённые отчёты -->
                        <div class="mt-6">
                            <div class="flex items-center justify-between mb-3">
                                <h5 class="text-sm font-medium text-gray-900">Сохранённые отчёты</h5>
                                <button id="saveCurrentReportBtn" class="btn btn-xs btn-primary" title="Сохранить отчёт на основе выбранного шаблона фильтра">
                                    <svg class="mr-1 h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path>
                                    </svg>
                                    📊 Сохранить отчёт
                                </button>
                            </div>
                            <div class="datatables-container">
                                <!-- Лоадер для таблицы отчётов -->
                                <div id="savedReportsLoader" class="flex items-center justify-center p-8 bg-gray-50 rounded-md border border-gray-200">
                                    <div class="flex items-center space-x-3">
                                        <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
                                        <span class="text-sm text-gray-600">Загрузка сохранённых отчётов...</span>
                                    </div>
                                </div>
                                <table class="display nowrap" id="savedReportsTable" style="width:100%; display:none;">
                                    <thead>
                                        <tr>
                                            <th>Название</th>
                                            <th>Фильтры</th>
                                            <th>Создан</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Данные загружаются динамически -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Отчёты -->
                    <div id="reportsContent" class="space-y-8 hidden">
                        
                        <!-- Отчёт Ликвидность -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">Ликвидность сегмента/подсегмента</h4>
                            <p class="text-sm text-gray-600 mb-6">
                                Столбчатая диаграмма показывает количество новых объектов и ушедших с рынка по месяцам. 
                                Линия показывает количество активных объектов на начало месяца.
                            </p>
                            <div id="liquidityChart" class="h-96">
                                <div class="flex items-center justify-center h-full text-gray-500">
                                    Выберите период и нажмите "Показать отчёты"
                                </div>
                            </div>
                        </div>

                        <!-- Отчёт Изменение средней цены -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">Изменение средней цены</h4>
                            <p class="text-sm text-gray-600 mb-6">
                                График показывает изменение средней цены объектов и средней цены за квадратный метр по месяцам.
                            </p>
                            <div id="priceChangesChart" class="h-96">
                                <div class="flex items-center justify-center h-full text-gray-500">
                                    Выберите период и нажмите "Показать отчёты"
                                </div>
                            </div>
                        </div>

                        <!-- Отчёт Коридор рынка недвижимости -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex-1">
                                    <h4 class="text-lg font-medium text-gray-900 mb-2">Коридор рынка недвижимости</h4>
                                    <p class="text-sm text-gray-600" id="marketCorridorDescription">
                                        График отображает точки последних цен в объектах недвижимости по вертикали, по горизонтали дата последнего обновления объекта недвижимости.
                                    </p>
                                </div>
                                
                                <!-- Переключатель режимов (SlimSelect) -->
                                <div class="ml-4">
                                    <label for="marketCorridorModeSelect" class="block text-sm font-medium text-gray-700 mb-1">Режим графика</label>
                                    <select id="marketCorridorModeSelect" class="min-w-[180px]">
                                        <option value="sales">Коридор продаж</option>
                                        <option value="history">История активных</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div id="marketCorridorChart" class="h-96">
                                <div class="flex items-center justify-center h-full text-gray-500">
                                    Выберите период и нажмите "Показать отчёты"
                                </div>
                            </div>
                        </div>

                        <!-- Отчёт Сравнительный анализ -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex-1">
                                    <h4 class="text-lg font-medium text-gray-900 mb-2">Сравнительный анализ</h4>
                                    <p class="text-sm text-gray-600">
                                        Инструмент для определения оптимальной стартовой цены путем сравнения абстрактного объекта с конкурентами на рынке.
                                    </p>
                                </div>
                            </div>
                            
                            <div id="comparativeAnalysisContainer" class="comparative-analysis-wrapper">
                                <div class="flex items-center justify-center h-64 text-gray-500" id="comparativeAnalysisPlaceholder">
                                    Выберите период и нажмите "Показать отчёты"
                                </div>
                                
                                <!-- Основной интерфейс сравнительного анализа -->
                                <div id="comparativeAnalysisContent" class="comparative-analysis-container hidden">
                                    <!-- Панель управления анализом (на всю ширину) -->
                                    <div class="management-panel">
                                        <!-- Заголовок и управление анализом -->
                                        <div class="analysis-header mb-4">
                                            <h5 class="text-base font-medium text-gray-900">Управление анализом</h5>
                                            <div class="analysis-controls">
                                                <button id="resetComparisonBtn" class="btn btn-sm btn-warning">Сбросить сравнение</button>
                                            </div>
                                        </div>
                                        
                                        <!-- Фильтр статусов -->
                                        <div class="status-filter mb-4">
                                            <button class="filter-btn active" data-status="all">Все</button>
                                            <button class="filter-btn" data-status="active">Активные</button>
                                            <button class="filter-btn" data-status="archive">Архивные</button>
                                        </div>
                                        
                                        <!-- Блоки объектов -->
                                        <div class="objects-grid mb-4" id="objectsGrid">
                                            <!-- Динамически генерируемые блоки объектов -->
                                        </div>
                                        
                                        <!-- Секция с объявлениями и деталями -->
                                        <div class="listings-section mb-4 grid grid-cols-4 gap-4 h-96" id="listingsSection">
                                            <!-- Объявления выбранного объекта (1/4 ширины) -->
                                            <div class="listings-panel col-span-1 min-h-96" id="listingsPanel">
                                                <h6 class="text-sm font-medium text-gray-900 mb-2">Объявления объекта</h6>
                                                <div class="listings-list" id="listingsList">
                                                    <!-- Блоки объявлений -->
                                                    <div class="text-sm text-gray-500">Выберите объект для просмотра объявлений</div>
                                                </div>
                                            </div>
                                            
                                            <!-- Детали объявления (3/4 ширины) -->
                                            <div class="listing-details col-span-3 min-h-96" id="listingDetails">
                                                <div class="photos-gallery" id="photosGallery">
                                                    <!-- Фотографии -->
                                                </div>
                                                <div class="listing-description" id="listingDescription">
                                                    <!-- Описание -->
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Кнопки оценки -->
                                        <div class="evaluation-buttons flex justify-between items-center gap-6" id="evaluationButtons">
                                            <!-- Левая группа - исключающие оценки -->
                                            <div class="exclude-buttons flex gap-3">
                                                <button class="eval-btn exclude" data-evaluation="fake">Фейк</button>
                                                <button class="eval-btn exclude" data-evaluation="not-competitor">Не конкурент</button>
                                                <button class="eval-btn exclude" data-evaluation="not-sold">Переоценён</button>
                                            </div>
                                            
                                            <!-- Правая группа - оценочные кнопки -->
                                            <div class="evaluation-buttons-right flex gap-3">
                                                <button class="eval-btn worse" data-evaluation="worse">Хуже</button>
                                                <button class="eval-btn equal" data-evaluation="equal">Равно</button>
                                                <button class="eval-btn better" data-evaluation="better">Лучше</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Нижняя секция с графиком и результатами -->
                                    <div class="analysis-results-section grid grid-cols-3 gap-6">
                                        <!-- График (2/3 ширины) -->
                                        <div class="chart-panel col-span-2">
                                            <h4 class="text-lg font-medium text-gray-800 mb-4">График анализа</h4>
                                            <div id="comparativeChart" class="h-96">
                                                <!-- График будет создаваться динамически -->
                                            </div>
                                        </div>
                                        
                                        <!-- Результат анализа (1/3 ширины) -->
                                        <div class="results-panel col-span-1">
                                            <h4 class="text-lg font-medium text-gray-800 mb-4">Результат анализа</h4>
                                            <div class="corridor-info" id="corridorInfo">
                                                <div class="corridor-section mb-3">
                                                    <div class="text-xs font-medium text-blue-600 mb-1">Активные объекты:</div>
                                                    <div id="activeCorridor" class="text-sm text-gray-700 bg-blue-50 p-2 rounded">-</div>
                                                </div>
                                                <div class="corridor-section mb-3">
                                                    <div class="text-xs font-medium text-green-600 mb-1">Архивные объекты:</div>
                                                    <div id="archiveCorridor" class="text-sm text-gray-700 bg-green-50 p-2 rounded">-</div>
                                                </div>
                                                <div class="corridor-section optimal">
                                                    <div class="text-xs font-medium text-emerald-600 mb-1">Оптимальный диапазон:</div>
                                                    <div id="optimalRange" class="text-sm font-semibold text-emerald-700 bg-emerald-50 p-3 rounded border-l-4 border-emerald-400">-</div>
                                                </div>
                                                <div class="corridor-section confidence mt-4">
                                                    <div class="text-xs font-medium text-purple-600 mb-1">Статистическая достоверность:</div>
                                                    <div id="confidenceLevel" class="text-sm bg-purple-50 p-2 rounded">
                                                        <div class="flex items-center mb-2">
                                                            <div class="confidence-bar bg-gray-200 rounded-full h-2 flex-1 mr-2 overflow-hidden">
                                                                <div id="confidenceProgress" class="h-full bg-purple-500 transition-all duration-500" style="width: 0%"></div>
                                                            </div>
                                                            <span id="confidencePercent" class="text-xs font-medium text-purple-700">0%</span>
                                                        </div>
                                                        <div id="confidenceMessage" class="text-xs text-gray-600 mb-1">Коридор не определён</div>
                                                        <div id="confidenceRecommendation" class="text-xs text-blue-600 italic">Начните оценивать объекты</div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Индикатор несохранённых изменений в сравнительном анализе -->
                                                <div id="comparativeUnsavedIndicator" class="hidden mt-4 p-2 bg-yellow-50 border border-yellow-200 rounded-md">
                                                    <div class="flex items-center">
                                                        <div class="flex-shrink-0">
                                                            <svg class="h-4 w-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                                            </svg>
                                                        </div>
                                                        <div class="ml-2">
                                                            <p class="text-xs text-yellow-700">
                                                                <strong>Несохранённые изменения в анализе</strong> - сохраните шаблон для сохранения состояния
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        
                        <!-- Отчёт Доходность флиппинг -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6" id="flippingProfitabilityReport">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex-1">
                                    <h4 class="text-lg font-medium text-gray-900 mb-2">Доходность флиппинг</h4>
                                    <p class="text-sm text-gray-600">
                                        Анализ доходности объектов недвижимости для инвестиций в модель флиппинг с калькулятором финансовой модели.
                                    </p>
                                </div>
                            </div>
                            
                            <div id="flippingProfitabilityContainer" class="flipping-profitability-wrapper">
                                <div class="flex items-center justify-center h-64 text-gray-500" id="flippingProfitabilityPlaceholder">
                                    Выберите период и нажмите "Показать отчёты"
                                </div>
                                
                                <!-- Основной интерфейс отчёта доходности флиппинг -->
                                <div id="flippingProfitabilityContent" class="flipping-profitability-container hidden">
                                    
                                    <!-- Верхняя секция: карта + фильтр -->
                                    <div class="grid grid-cols-12 gap-6 mb-6">
                                        
                                        <!-- Карта (2/3 ширины) -->
                                        <div class="col-span-8">
                                            <div class="bg-gray-50 border border-gray-200 rounded-lg h-96 overflow-hidden">
                                                <div class="p-4 border-b border-gray-200 bg-white rounded-t-lg">
                                                    <h5 class="text-md font-medium text-gray-900">Карта доходности</h5>
                                                </div>
                                                <div class="relative h-80">
                                                    <div id="flippingProfitabilityMap" class="w-full h-full"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Фильтр (1/3 ширины) -->
                                        <div class="col-span-4">
                                            <div class="bg-gray-50 border border-gray-200 rounded-lg h-96 overflow-y-auto">
                                                <div class="p-4 border-b border-gray-200 bg-white rounded-t-lg">
                                                    <h5 class="text-md font-medium text-gray-900">Фильтр параметров</h5>
                                                </div>
                                                <div class="p-4" id="flippingProfitabilityFilter">
                                                    
                                                    <!-- Количество комнат -->
                                                    <div class="mb-4">
                                                        <label class="block text-sm font-medium text-gray-700 mb-2">Количество комнат</label>
                                                        <div class="flex flex-wrap gap-2">
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-gray-700 hover:bg-gray-100 hover:border-gray-400 transition-colors" data-rooms="studio">Студия</button>
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-gray-700 hover:bg-gray-100 hover:border-gray-400 transition-colors" data-rooms="1">1к</button>
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-gray-700 hover:bg-gray-100 hover:border-gray-400 transition-colors" data-rooms="2">2к</button>
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-gray-700 hover:bg-gray-100 hover:border-gray-400 transition-colors" data-rooms="3">3к</button>
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-gray-700 hover:bg-gray-100 hover:border-gray-400 transition-colors" data-rooms="4+">4+</button>
                                                        </div>
                                                    </div>

                                                    <!-- Цена -->
                                                    <div class="mb-4">
                                                        <label class="block text-sm font-medium text-gray-700 mb-2">Цена</label>
                                                        <div class="grid grid-cols-2 gap-2">
                                                            <input type="number" id="flippingPriceFrom" placeholder="0" 
                                                                   class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                            <input type="number" id="flippingPriceTo" placeholder="10000000000" 
                                                                   class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                        </div>
                                                    </div>

                                                    <!-- Процент для пересчёта доходности -->
                                                    <div class="mb-4">
                                                        <label for="flippingProfitabilityPercent" class="block text-sm font-medium text-gray-700 mb-2">Целевая доходность</label>
                                                        <input type="number" id="flippingProfitabilityPercent" value="60" 
                                                               class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                    </div>

                                                    <!-- Участники проекта -->
                                                    <div class="mb-4">
                                                        <label class="block text-sm font-medium text-gray-700 mb-2">Участники проекта</label>
                                                        <div class="flex gap-2">
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-blue-500 rounded-md bg-blue-500 text-white hover:bg-blue-600 transition-colors" data-participants="flipper" id="flippingParticipantsFlipper">Флиппер</button>
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-gray-700 hover:bg-gray-100 hover:border-gray-400 transition-colors" data-participants="flipper-investor" id="flippingParticipantsFlipperInvestor">Флиппер + Инвестор</button>
                                                        </div>
                                                    </div>

                                                    <!-- Форма раздела прибыли (условное поле) -->
                                                    <div class="conditional-field mb-4 hidden" id="flippingProfitSharingSection">
                                                        <label class="block text-sm font-medium text-gray-700 mb-2">Форма раздела прибыли</label>
                                                        <div class="flex gap-2 mb-3">
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-blue-500 rounded-md bg-blue-500 text-white hover:bg-blue-600 transition-colors" data-profit-sharing="percentage" id="flippingProfitSharingPercentage">Раздел в %</button>
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-gray-700 hover:bg-gray-100 hover:border-gray-400 transition-colors" data-profit-sharing="fix-plus-percentage" id="flippingProfitSharingFixPlus">Фикс + %</button>
                                                        </div>
                                                        
                                                        <!-- Настройка процентов для раздела -->
                                                        <div id="flippingProfitPercentageSettings" class="space-y-2">
                                                            <div>
                                                                <label for="flippingFlipperPercentage" class="block text-xs font-medium text-gray-600 mb-1">Процент флиппера</label>
                                                                <input type="number" id="flippingFlipperPercentage" value="50" min="0" max="100"
                                                                       class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                            </div>
                                                            <div>
                                                                <label for="flippingInvestorPercentage" class="block text-xs font-medium text-gray-600 mb-1">Процент инвестора</label>
                                                                <input type="number" id="flippingInvestorPercentage" value="50" min="0" max="100" readonly
                                                                       class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm bg-gray-50">
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Настройка фиксированной оплаты + процент -->
                                                        <div id="flippingFixedPlusPercentageSettings" class="space-y-2 hidden">
                                                            <div>
                                                                <label for="flippingFixedPaymentAmount" class="block text-xs font-medium text-gray-600 mb-1">Фиксированная оплата флиппера, ₽</label>
                                                                <input type="number" id="flippingFixedPaymentAmount" value="250000"
                                                                       class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                            </div>
                                                            <div>
                                                                <label for="flippingFixedPlusPercentage" class="block text-xs font-medium text-gray-600 mb-1">Процент флиппера с остатка прибыли</label>
                                                                <input type="number" id="flippingFixedPlusPercentage" value="30" min="0" max="100"
                                                                       class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Источник финансирования -->
                                                    <div class="mb-4">
                                                        <label class="block text-sm font-medium text-gray-700 mb-2">Источник финансирования</label>
                                                        <div class="flex gap-2">
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-blue-500 rounded-md bg-blue-500 text-white hover:bg-blue-600 transition-colors" data-financing="cash" id="flippingFinancingCash">Деньги</button>
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-gray-700 hover:bg-gray-100 hover:border-gray-400 transition-colors" data-financing="mortgage" id="flippingFinancingMortgage">Ипотека</button>
                                                        </div>
                                                    </div>

                                                    <!-- Параметры ипотеки (условные поля) -->
                                                    <div class="conditional-field mb-4 hidden" id="flippingMortgageSection">
                                                        <div class="space-y-3">
                                                            <div>
                                                                <label for="flippingDownPayment" class="block text-sm font-medium text-gray-700 mb-2">Первоначальный взнос %</label>
                                                                <input type="number" id="flippingDownPayment" value="20" 
                                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                            </div>
                                                            <div>
                                                                <label for="flippingMortgageRate" class="block text-sm font-medium text-gray-700 mb-2">Ставка ипотеки %</label>
                                                                <input type="number" id="flippingMortgageRate" value="17" 
                                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                            </div>
                                                            <div>
                                                                <label for="flippingMortgageTerm" class="block text-sm font-medium text-gray-700 mb-2">Срок ипотеки, лет</label>
                                                                <input type="number" id="flippingMortgageTerm" value="20" 
                                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Тип налогообложения -->
                                                    <div class="mb-4">
                                                        <label class="block text-sm font-medium text-gray-700 mb-2">Тип налогообложения</label>
                                                        <div class="flex gap-2">
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-blue-500 rounded-md bg-blue-500 text-white hover:bg-blue-600 transition-colors" data-tax="ip">ИП</button>
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-gray-700 hover:bg-gray-100 hover:border-gray-400 transition-colors" data-tax="individual">Физик</button>
                                                        </div>
                                                    </div>

                                                    <!-- Скорость ремонта -->
                                                    <div class="mb-4">
                                                        <label for="flippingRenovationSpeed" class="block text-sm font-medium text-gray-700 mb-2">Скорость ремонта, м2/день</label>
                                                        <input type="number" id="flippingRenovationSpeed" value="1.5" step="0.1" 
                                                               class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                    </div>

                                                    <!-- Расчёт стоимости ремонта -->
                                                    <div class="mb-4">
                                                        <label class="block text-sm font-medium text-gray-700 mb-2">Расчёт стоимости ремонта</label>
                                                        <div class="flex gap-2">
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-blue-500 rounded-md bg-blue-500 text-white hover:bg-blue-600 transition-colors" data-renovation="auto" id="flippingRenovationAuto">Автоматический</button>
                                                            <button type="button" class="px-3 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-gray-700 hover:bg-gray-100 hover:border-gray-400 transition-colors" data-renovation="manual" id="flippingRenovationManual">Ручной</button>
                                                        </div>
                                                    </div>

                                                    <!-- Ручной расчёт ремонта (условные поля) -->
                                                    <div class="conditional-field mb-4 hidden" id="flippingManualRenovationSection">
                                                        <div class="grid grid-cols-2 gap-3">
                                                            <div>
                                                                <label for="flippingWorkCost" class="block text-sm font-medium text-gray-700 mb-2">Работа, руб/м2</label>
                                                                <input type="number" id="flippingWorkCost" value="10000" 
                                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                            </div>
                                                            <div>
                                                                <label for="flippingMaterialsCost" class="block text-sm font-medium text-gray-700 mb-2">Материалы, руб/м2</label>
                                                                <input type="number" id="flippingMaterialsCost" value="10000" 
                                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Дополнительные расходы -->
                                                    <div class="mb-4">
                                                        <label for="flippingAdditionalExpenses" class="block text-sm font-medium text-gray-700 mb-2">Дополнительные расходы</label>
                                                        <input type="number" id="flippingAdditionalExpenses" value="100000" 
                                                               class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                    </div>


                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- График коридора рынка недвижимости с боковой панелью объектов -->
                                    <div class="bg-gray-50 border border-gray-200 rounded-lg mb-6">
                                        <div class="p-4 border-b border-gray-200 bg-white rounded-t-lg">
                                            <div class="flex items-center justify-between">
                                                <h5 class="text-md font-medium text-gray-900">Коридор рынка недвижимости</h5>
                                                <div class="flex items-center space-x-2">
                                                    <label for="flippingMarketCorridorMode" class="text-sm text-gray-600">Режим:</label>
                                                    <select id="flippingMarketCorridorMode" class="slim-select-minimal">
                                                        <option value="sales">Коридор продаж</option>
                                                        <option value="history">История активных</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="p-4 bg-white rounded-b-lg">
                                            <div class="grid grid-cols-3 gap-4 h-[28rem]">
                                                <!-- График (2/3 ширины) -->
                                                <div class="col-span-2">
                                                    <div id="flippingMarketCorridorChart" class="h-full">
                                                        <div class="flex items-center justify-center h-full text-gray-500">
                                                            Примените фильтры для отображения данных
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Панель объектов (1/3 ширины) -->
                                                <div class="col-span-1 border-l border-gray-200 pl-4 h-[28rem] overflow-hidden">
                                                    <div class="h-full flex flex-col">
                                                        <!-- Карточки подсегментов с эталонными ценами -->
                                                        <div id="referencePriceCardsContainer" class="mb-3 flex-shrink-0 flex flex-col gap-2 max-h-48 overflow-y-auto p-2 hidden">
                                                            <!-- Карточки подсегментов будут динамически добавляться через JavaScript -->
                                                        </div>
                                                        
                                                        <h6 class="text-sm font-medium text-gray-900 mb-3 flex-shrink-0">Оценка эталонных объектов</h6>
                                                        
                                                        <!-- Селектор оценки объекта -->
                                                        <div class="mb-3 flex-shrink-0">
                                                            <label for="objectEvaluationSelect" class="block text-xs font-medium text-gray-700 mb-1">Оценка</label>
                                                            <select id="objectEvaluationSelect" class="w-full text-sm">
                                                                <option value="">Выберите оценку</option>
                                                                <option value="flipping">Флиппинг</option>
                                                                <option value="designer_renovation">Дизайнерский ремонт</option>
                                                                <option value="euro_renovation">Евроремонт</option>
                                                            </select>
                                                        </div>
                                                        
                                                        <div class="flex-1 overflow-y-auto min-h-0 max-h-80">
                                                            <div id="flippingObjectsGrid" class="grid grid-cols-1 gap-2 p-2">
                                                                <div class="text-center text-gray-500 py-4 text-sm">
                                                                    Примените фильтры для отображения объектов
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Таблица объектов -->
                                    <div class="bg-gray-50 border border-gray-200 rounded-lg">
                                        <div class="p-4 border-b border-gray-200 bg-white rounded-t-lg">
                                            <h5 class="text-md font-medium text-gray-900">Объекты для инвестирования</h5>
                                        </div>
                                        
                                        <!-- Контейнер для таблицы -->
                                        <div class="p-4 bg-white rounded-b-lg">
                                            <div id="flippingTableContainer">
                                                <!-- Панель управления выбором -->
                                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 hidden" id="flippingSelectionPanel">
                                                    <div class="flex items-center justify-between">
                                                        <span id="flippingSelectedItemsCount" class="text-sm font-medium text-blue-800">0 элементов выбрано</span>
                                                        <button type="button" id="flippingClearSelectionBtn" class="ml-4 text-sm text-blue-600 hover:text-blue-800 underline">
                                                            Очистить выбор
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <!-- Фильтры таблицы флиппинг -->
                                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
                                                    <div class="flex items-center justify-between mb-3">
                                                        <h4 class="text-sm font-medium text-gray-900">Фильтры отчёта</h4>
                                                        <button type="button" id="clearAllFlippingFiltersBtn" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                                            <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                            </svg>
                                                            Очистить все
                                                        </button>
                                                    </div>
                                                    
                                                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                                        <!-- Фильтр по адресу -->
                                                        <div>
                                                            <label for="flippingAddressFilter" class="block text-xs font-medium text-gray-700 mb-1">Адрес</label>
                                                            <select id="flippingAddressFilter">
                                                                <option value="">Все адреса</option>
                                                                <!-- Опции будут загружены динамически -->
                                                            </select>
                                                        </div>
                                                        
                                                        <!-- Фильтр по типу недвижимости -->
                                                        <div>
                                                            <label for="flippingPropertyTypeFilter" class="block text-xs font-medium text-gray-700 mb-1">Тип недвижимости</label>
                                                            <select id="flippingPropertyTypeFilter">
                                                                <option value="">Все типы</option>
                                                                <option value="studio">Студия</option>
                                                                <option value="1k">1-к квартира</option>
                                                                <option value="2k">2-к квартира</option>
                                                                <option value="3k">3-к квартира</option>
                                                                <option value="4k+">4+ к квартира</option>
                                                            </select>
                                                        </div>
                                                        
                                                        <!-- Фильтр по статусу -->
                                                        <div>
                                                            <label for="flippingStatusFilter" class="block text-xs font-medium text-gray-700 mb-1">Статус</label>
                                                            <select id="flippingStatusFilter">
                                                                <option value="">Все статусы</option>
                                                                <option value="active">Активные</option>
                                                                <option value="archive">Архивные</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Активные фильтры -->
                                                    <div id="flippingActiveFiltersContainer" class="mt-3 hidden">
                                                        <div class="flex items-center space-x-2">
                                                            <span class="text-xs text-gray-500">Активные фильтры:</span>
                                                            <div id="flippingActiveFilterTags" class="flex flex-wrap gap-1">
                                                                <!-- Теги активных фильтров будут добавляться динамически -->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="overflow-x-auto">
                                                    <table id="flippingTable" class="min-w-full divide-y divide-gray-200">
                                                        <!-- DataTables будет автоматически создавать заголовки -->
                                                    </table>
                                                </div>
                                                
                                                <!-- Заглушка для пустой таблицы -->
                                                <div id="flippingTableEmpty" class="text-center py-12 hidden">
                                                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                    </svg>
                                                    <h3 class="mt-2 text-sm font-medium text-gray-900">Нет данных</h3>
                                                    <p class="mt-1 text-sm text-gray-500">Объекты для инвестирования не найдены</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Таблица дублей и объектов -->
        <div id="duplicatesPanelContainer" class="mt-8 bg-white shadow overflow-hidden sm:rounded-md">
            <div class="px-4 py-5 sm:px-6 cursor-pointer" id="duplicatesPanelHeader">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Управление дублями</h3>
                        <p class="mt-1 text-sm text-gray-500">Управление объявлениями и объектами недвижимости, требующими обработки дублей</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <svg id="duplicatesPanelChevron" class="h-5 w-5 text-gray-400 transform transition-transform duration-200" style="transform: rotate(-90deg);" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div id="duplicatesPanelContent" class="px-4 pb-5 hidden">
                <div class="mb-6 flex items-center justify-between">
                    <!-- Панель фильтров сегментов -->
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-md">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="text-sm font-medium text-gray-900">Фильтр сегментов</h4>
                            <button type="button" id="clearSegmentFiltersBtn" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                Очистить
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- Фильтр по статусу -->
                            <div>
                                <label for="duplicatesStatusFilter" class="block text-xs font-medium text-gray-700 mb-1">Статус</label>
                                <select id="duplicatesStatusFilter">
                                    <option value="all">Все</option>
                                    <option value="active">Активные</option>
                                    <option value="archived">Архивные</option>
                                </select>
                            </div>
                            
                            <!-- Фильтр по сегменту -->
                            <div>
                                <label for="duplicatesSegmentFilter" class="block text-xs font-medium text-gray-700 mb-1">Сегмент</label>
                                <select id="duplicatesSegmentFilter">
                                    <option value="">Все сегменты</option>
                                    <!-- Опции будут загружены динамически -->
                                </select>
                            </div>
                            
                            <!-- Фильтр по подсегменту -->
                            <div>
                                <label for="duplicatesSubsegmentFilter" class="block text-xs font-medium text-gray-700 mb-1">Подсегмент</label>
                                <select id="duplicatesSubsegmentFilter" disabled>
                                    <option value="">Все подсегменты</option>
                                    <!-- Опции будут загружены динамически -->
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        
                        <!-- Кнопки операций -->
                        <button type="button" id="mergeDuplicatesBtn" disabled class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 disabled:bg-gray-300 disabled:cursor-not-allowed" title="Создать объект недвижимости из выбранных элементов">
                            <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                            </svg>
                            Объединить
                        </button>
                        
                        <button type="button" id="splitDuplicatesBtn" disabled class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700 disabled:bg-gray-300 disabled:cursor-not-allowed">
                            <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                            Разбить дубли
                        </button>
                        
                        <button type="button" id="correctAddressBtn" disabled class="hidden inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed">
                            <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            Верный адрес
                        </button>
                    </div>
                </div>
                <!-- Фильтры обработки -->
                <div class="mb-6 p-4 bg-gray-50 border border-gray-200 rounded-md">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-gray-900">Фильтр обработки</h4>
                        <button type="button" id="clearProcessingFiltersBtn" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            <svg class="-ml-0.5 mr-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                            Очистить все
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- Фильтр по статусу обработки -->
                        <div>
                            <label for="processingStatusFilter" class="block text-xs font-medium text-gray-700 mb-1">Статус обработки</label>
                            <select id="processingStatusFilter">
                                <option value="">Все статусы</option>
                                <option value="address_needed">Определить адрес</option>
                                <option value="duplicate_check_needed">Обработать на дубли</option>
                                <option value="needs_update">Актуализировать</option>
                            </select>
                        </div>
                        
                        <!-- Фильтр по адресу -->
                        <div>
                            <label for="processingAddressFilter" class="block text-xs font-medium text-gray-700 mb-1">Адрес</label>
                            <select id="processingAddressFilter">
                                <option value="">Все адреса</option>
                                <!-- Опции будут загружены динамически -->
                            </select>
                        </div>
                        
                        <!-- Фильтр по типу недвижимости -->
                        <div>
                            <label for="processingPropertyTypeFilter" class="block text-xs font-medium text-gray-700 mb-1">Тип недвижимости</label>
                            <select id="processingPropertyTypeFilter">
                                <option value="">Все типы</option>
                                <option value="studio">Студия</option>
                                <option value="1k">1-к квартира</option>
                                <option value="2k">2-к квартира</option>
                                <option value="3k">3-к квартира</option>
                                <option value="4k+">4+ к квартира</option>
                            </select>
                        </div>
                        
                        <!-- Фильтр по этажу -->
                        <div>
                            <label for="processingFloorFilter" class="block text-xs font-medium text-gray-700 mb-1">Этаж</label>
                            <input type="number" id="processingFloorFilter" min="1" max="100" placeholder="Любой этаж" class="block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm placeholder:text-gray-400 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500">
                        </div>
                        
                    </div>
                    
                    <!-- Активные фильтры -->
                    <div id="activeFiltersContainer" class="mt-3 hidden">
                        <div class="flex items-center space-x-2">
                            <span class="text-xs text-gray-500">Активные фильтры:</span>
                            <div id="activeFilterTags" class="flex flex-wrap gap-1">
                                <!-- Теги активных фильтров будут добавляться динамически -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Счетчик выбранных элементов -->
                <div id="selectedItemsInfo" class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md hidden">
                    <div class="flex items-center">
                        <svg class="h-5 w-5 text-blue-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        <span id="selectedItemsCount" class="text-sm font-medium text-blue-800">0 элементов выбрано</span>
                        <button type="button" id="clearSelectionBtn" class="ml-4 text-sm text-blue-600 hover:text-blue-800 underline">
                            Очистить выбор
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table id="duplicatesTable" class="min-w-full divide-y divide-gray-200">
                        <!-- DataTables будет автоматически создавать заголовки -->
                    </table>
                </div>
                
                <!-- Заглушка для пустой таблицы -->
                <div id="duplicatesTableEmpty" class="text-center py-12 hidden">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">Нет данных</h3>
                    <p class="mt-1 text-sm text-gray-500">Объявления и объекты для обработки дублей не найдены</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно редактирования области -->
    <div id="editAreaModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="mx-auto flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-middle bg-white rounded-lg border text-left overflow-hidden shadow-xl transform transition-all my-8 max-w-lg w-full relative z-10">
                <form id="editAreaForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                <h3 class="text-lg leading-6 font-medium text-gray-900">
                                    Редактировать область
                                </h3>
                                <div class="mt-4 space-y-4">
                                    <div>
                                        <label for="editAreaName" class="block text-sm font-medium text-gray-700">Название области</label>
                                        <input type="text" name="name" id="editAreaName" required
                                               class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                    </div>

                                    <div>
                                        <label for="editAvitoUrl" class="block text-sm font-medium text-gray-700">URL фильтра Avito</label>
                                        <div class="mt-1 flex gap-2">
                                            <input type="url" name="avito_filter_url" id="editAvitoUrl"
                                                   class="flex-1 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            <button type="button" id="openAvitoBtn" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>
                                                <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                                </svg>
                                                Открыть Avito
                                            </button>
                                        </div>
                                    </div>

                                    <div>
                                        <label for="editCianUrl" class="block text-sm font-medium text-gray-700">URL фильтра Cian</label>
                                        <div class="mt-1 flex gap-2">
                                            <input type="url" name="cian_filter_url" id="editCianUrl"
                                                   class="flex-1 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            <button type="button" id="openCianBtn" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>
                                                <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                                </svg>
                                                Открыть Cian
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelEditArea" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно редактирования адреса -->
    <div id="editAddressModal" class="fixed inset-0 z-60 hidden overflow-y-auto" aria-labelledby="address-modal-title" role="dialog" aria-modal="true">
        <div class="mx-auto flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full relative z-10 max-h-[90vh]">
                <form id="editAddressForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="w-full">
                                <!-- Заголовок -->
                                <div class="flex items-center justify-between mb-4">
                                    <h3 id="address-modal-title" class="text-lg leading-6 font-medium text-gray-900">
                                        Редактировать адрес
                                    </h3>
                                </div>
                                
                                <!-- Содержимое с прокруткой -->
                                <div class="max-h-[70vh] overflow-y-auto">
                                    <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                
                                <div class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <!-- Левая колонка - поля формы -->
                                    <div class="space-y-4">
                                        <div>
                                            <label for="editAddressText" class="block text-sm font-medium text-gray-700">Адрес</label>
                                            <input type="text" name="address" id="editAddressText" required
                                                   class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                        </div>

                                        <div>
                                            <label for="editAddressType" class="block text-sm font-medium text-gray-700">Тип</label>
                                            <select name="type" id="editAddressType" required>
                                                <option value="house">Дом</option>
                                                <option value="house_with_land">Дом с участком</option>
                                                <option value="land">Участок</option>
                                                <option value="commercial">Коммерция</option>
                                                <option value="building">Здание</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label for="editHouseSeries" class="block text-sm font-medium text-gray-700">Серия дома</label>
                                            <div class="flex gap-2">
                                                <select name="house_series_id" id="editHouseSeries">
                                                    <option value="">Выберите серию...</option>
                                                </select>
                                                <button type="button" id="houseSeriesActionBtn" 
                                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 h-9">
                                                    + Добавить
                                                </button>
                                            </div>
                                        </div>

                                        <div>
                                            <label for="editHouseClass" class="block text-sm font-medium text-gray-700">Класс дома</label>
                                            <div class="flex gap-2">
                                                <select name="house_class_id" id="editHouseClass">
                                                    <option value="">Выберите класс...</option>
                                                </select>
                                                <button type="button" id="houseClassActionBtn" 
                                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 h-9">
                                                    + Добавить
                                                </button>
                                            </div>
                                        </div>

                                        <div>
                                            <label for="editWallMaterial" class="block text-sm font-medium text-gray-700">Материал стен</label>
                                            <div class="flex gap-2">
                                                <select name="wall_material_id" id="editWallMaterial">
                                                    <option value="">Выберите материал...</option>
                                                </select>
                                                <button type="button" id="wallMaterialActionBtn" 
                                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 h-9">
                                                    + Добавить
                                                </button>
                                            </div>
                                        </div>

                                        <div>
                                            <label for="editCeilingMaterial" class="block text-sm font-medium text-gray-700">Материал перекрытий</label>
                                            <div class="flex gap-2">
                                                <select name="ceiling_material_id" id="editCeilingMaterial">
                                                    <option value="">Выберите материал...</option>
                                                </select>
                                                <button type="button" id="ceilingMaterialActionBtn" 
                                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 h-9">
                                                    + Добавить
                                                </button>
                                            </div>
                                        </div>

                                        <div>
                                            <label for="editHouseProblem" class="block text-sm font-medium text-gray-700">Проблемы дома</label>
                                            <div class="flex gap-2">
                                                <select name="house_problem_id" id="editHouseProblem">
                                                    <option value="">Выберите проблему...</option>
                                                </select>
                                                <button type="button" id="houseProblemActionBtn" 
                                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 h-9">
                                                    + Добавить
                                                </button>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label for="editGasSupply" class="block text-sm font-medium text-gray-700">Газоснабжение</label>
                                                <select name="gas_supply" id="editGasSupply">
                                                    <option value="">Не указано</option>
                                                    <option value="true">Да</option>
                                                    <option value="false">Нет</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="editIndividualHeating" class="block text-sm font-medium text-gray-700">Индивидуальное отопление</label>
                                                <select name="individual_heating" id="editIndividualHeating">
                                                    <option value="">Не указано</option>
                                                    <option value="true">Да</option>
                                                    <option value="false">Нет</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label for="editPlayground" class="block text-sm font-medium text-gray-700">Детская площадка</label>
                                                <select name="playground" id="editPlayground">
                                                    <option value="0">Не указано</option>
                                                    <option value="1">Да</option>
                                                    <option value="2">Нет</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="editSportsGround" class="block text-sm font-medium text-gray-700">Спортивная площадка</label>
                                                <select name="sports_ground" id="editSportsGround">
                                                    <option value="0">Не указано</option>
                                                    <option value="1">Да</option>
                                                    <option value="2">Нет</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label for="editClosedTerritory" class="block text-sm font-medium text-gray-700">Закрытая территория</label>
                                                <select name="closed_territory" id="editClosedTerritory">
                                                    <option value="0">Не указано</option>
                                                    <option value="1">Да</option>
                                                    <option value="2">Нет</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="editUndergroundParking" class="block text-sm font-medium text-gray-700">Подземная парковка</label>
                                                <select name="underground_parking" id="editUndergroundParking">
                                                    <option value="0">Не указано</option>
                                                    <option value="1">Да</option>
                                                    <option value="2">Нет</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label for="editCommercialSpaces" class="block text-sm font-medium text-gray-700">Коммерческие помещения</label>
                                                <select name="commercial_spaces" id="editCommercialSpaces">
                                                    <option value="0">Не указано</option>
                                                    <option value="1">Да</option>
                                                    <option value="2">Нет</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="editFloorsCount" class="block text-sm font-medium text-gray-700">Этажей</label>
                                                <input type="number" name="floors_count" id="editFloorsCount" min="1"
                                                       class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label for="editCeilingHeight" class="block text-sm font-medium text-gray-700">Высота потолков</label>
                                                <input type="text" name="ceiling_height" id="editCeilingHeight"
                                                       class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                                       placeholder="например: 2.7 м">
                                            </div>
                                            <div>
                                                <label for="editBuildYear" class="block text-sm font-medium text-gray-700">Год постройки</label>
                                                <input type="number" name="build_year" id="editBuildYear" min="1800" max="2100"
                                                       class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label for="editEntrancesCount" class="block text-sm font-medium text-gray-700">Подъездов</label>
                                                <input type="number" name="entrances_count" id="editEntrancesCount" min="1"
                                                       class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            </div>
                                            <div>
                                                <label for="editLivingSpaces" class="block text-sm font-medium text-gray-700">Жилых помещений</label>
                                                <input type="number" name="living_spaces_count" id="editLivingSpaces" min="1"
                                                       class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
                                            </div>
                                        </div>

                                    </div>
                                    
                                    <!-- Правая колонка - карта -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Местоположение на карте</label>
                                        <div id="editAddressMap" style="height: 400px; width: 100%;" class="border border-gray-300 rounded-md"></div>
                                        <p id="mapCoordinatesText" class="mt-2 text-sm text-gray-500">
                                            Перетащите маркер на карте для изменения координат
                                        </p>

                                        <!-- Блок ссылок на внешние сервисы -->
                                        <div class="mt-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-3">Просмотр на картах</label>
                                            <div class="grid grid-cols-1 gap-2 sm:grid-cols-3 sm:gap-3">
                                                <a id="url-2gis-address" href="#" target="_blank" class="inline-flex w-full justify-center rounded-md border border-gray-300 bg-green-100 px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-green-200">
                                                    2ГИС
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="ml-2 w-4 h-4">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path>
                                                    </svg>
                                                </a>
                                                <a id="url-yandex-address" href="#" target="_blank" class="inline-flex w-full justify-center rounded-md border border-gray-300 bg-red-100 px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-red-200">
                                                    Яндекс Карты
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="ml-2 w-4 h-4">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path>
                                                    </svg>
                                                </a>
                                                <a id="url-yandex-panorama-address" href="#" target="_blank" class="inline-flex w-full justify-center rounded-md border border-gray-300 bg-yellow-100 px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-yellow-200">
                                                    Панорамы
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="ml-2 w-4 h-4">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path>
                                                    </svg>
                                                </a>
                                            </div>
                                        </div>

                                        <!-- Поле комментария -->
                                        <div class="mt-6">
                                            <label for="editComment" class="block text-sm font-medium text-gray-700 mb-2">Комментарий</label>
                                            <textarea name="comment" id="editComment" rows="8"
                                                      class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6 resize-none"
                                                      placeholder="Введите комментарий к адресу..."
                                                      style="height: 300px; min-height: 300px;"></textarea>
                                        </div>
                                    </div>
                                </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelEditAddress" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Уведомления -->
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-4">
        <!-- Уведомления будут добавляться динамически -->
    </div>

    <!-- Футер -->
    <div id="footer-container"></div>

    <!-- Скрипты -->
    <script src="../libs/jquery/jquery-3.7.1.min.js"></script>
    <script src="../libs/datatables/datatables.min.js"></script>
    <script src="../libs/slimselect/slimselect.min.js"></script>
    
    <!-- Компоненты интерфейса -->
    <script src="../components/navigation.js"></script>
    <script src="../components/breadcrumbs.js"></script>
    <script src="../components/footer.js"></script>
    
    <!-- Leaflet JS -->
    <script src="../libs/leaflet/leaflet.js"></script>
    
    <!-- Leaflet Draw JS -->
    <script src="../libs/leaflet/leaflet.draw.js"></script>
    
    <!-- CSP-compliant Geo utilities -->
    <script src="../utils/lightweight-geo.js"></script>
    
    <!-- RBush for spatial indexing -->
    <script src="../libs/rbush/rbush.min.js"></script>
    
    <!-- OSM Overpass API utilities -->
    <script src="../utils/osm-overpass.js"></script>
    
    <!-- Модальное окно добавления материала стен -->
    <div id="wallMaterialModal" class="fixed inset-0 z-70 hidden overflow-y-auto" aria-labelledby="wall-material-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md relative z-10">
                <form id="wallMaterialForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="w-full">
                                <h3 id="wall-material-modal-title" class="text-lg leading-6 font-medium text-gray-900 mb-4">
                                    Добавить материал стен
                                </h3>
                                
                                <input type="hidden" name="id" id="wallMaterialId">
                                <div class="space-y-4">
                                    <div>
                                        <label for="wallMaterialName" class="block text-sm font-medium text-gray-700">Название материала</label>
                                        <input type="text" name="name" id="wallMaterialName" required
                                               class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                               placeholder="Например: Газобетонный">
                                    </div>
                                    <div>
                                        <label for="wallMaterialColor" class="block text-sm font-medium text-gray-700">Цвет маркера</label>
                                        <div class="flex gap-2 items-center mt-1">
                                            <input type="color" name="color" id="wallMaterialColor" 
                                                   value="#3b82f6"
                                                   class="h-10 w-16 rounded-md bg-white outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 cursor-pointer">
                                            <span class="text-sm text-gray-500">Выберите цвет для маркеров на карте</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" id="saveWallMaterial" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelWallMaterial" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно добавления серии дома -->
    <div id="houseSeriesModal" class="fixed inset-0 z-70 hidden overflow-y-auto" aria-labelledby="house-series-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md relative z-10">
                <form id="houseSeriesForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="w-full">
                                <h3 id="house-series-modal-title" class="text-lg leading-6 font-medium text-gray-900 mb-4">
                                    Добавить серию дома
                                </h3>
                                
                                <input type="hidden" name="id" id="houseSeriesId">
                                <div>
                                    <label for="houseSeriesName" class="block text-sm font-medium text-gray-700">Название серии</label>
                                    <input type="text" name="name" id="houseSeriesName" required
                                           class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                           placeholder="Например: П-44Т">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" id="saveHouseSeries" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelHouseSeries" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно добавления материала перекрытий -->
    <div id="ceilingMaterialModal" class="fixed inset-0 z-70 hidden overflow-y-auto" aria-labelledby="ceiling-material-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md relative z-10">
                <form id="ceilingMaterialForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="w-full">
                                <h3 id="ceiling-material-modal-title" class="text-lg leading-6 font-medium text-gray-900 mb-4">
                                    Добавить материал перекрытий
                                </h3>
                                
                                <input type="hidden" name="id" id="ceilingMaterialId">
                                <div>
                                    <label for="ceilingMaterialName" class="block text-sm font-medium text-gray-700">Название материала</label>
                                    <input type="text" name="name" id="ceilingMaterialName" required
                                           class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                           placeholder="Например: Смешанное">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" id="saveCeilingMaterial" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelCeilingMaterial" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно добавления класса дома -->
    <div id="houseClassModal" class="fixed inset-0 z-70 hidden overflow-y-auto" aria-labelledby="house-class-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md relative z-10">
                <form id="houseClassForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="w-full">
                                <h3 id="house-class-modal-title" class="text-lg leading-6 font-medium text-gray-900 mb-4">
                                    Добавить класс дома
                                </h3>
                                
                                <input type="hidden" name="id" id="houseClassId">
                                <div class="space-y-4">
                                    <div>
                                        <label for="houseClassName" class="block text-sm font-medium text-gray-700">Название класса</label>
                                        <input type="text" name="name" id="houseClassName" required
                                               class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                               placeholder="Например: Премиум">
                                    </div>
                                    <div>
                                        <label for="houseClassColor" class="block text-sm font-medium text-gray-700">Цвет маркера</label>
                                        <div class="flex gap-2 items-center mt-1">
                                            <input type="color" name="color" id="houseClassColor" 
                                                   value="#3b82f6"
                                                   class="h-10 w-16 rounded-md bg-white outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 cursor-pointer">
                                            <span class="text-sm text-gray-500">Выберите цвет для маркеров на карте</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" id="saveHouseClass" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelHouseClass" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно добавления проблемы дома -->
    <div id="houseProblemModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="house-problem-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md relative z-10">
                <form id="houseProblemForm">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="w-full">
                                <h3 id="house-problem-modal-title" class="text-lg leading-6 font-medium text-gray-900 mb-4">
                                    Добавить проблему дома
                                </h3>
                                
                                <input type="hidden" name="id" id="houseProblemId">
                                <div class="space-y-4">
                                    <div>
                                        <label for="houseProblemName" class="block text-sm font-medium text-gray-700">Название проблемы</label>
                                        <input type="text" name="name" id="houseProblemName" required
                                               class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                               placeholder="Например: Аварийный">
                                    </div>
                                    <div>
                                        <label for="houseProblemColor" class="block text-sm font-medium text-gray-700">Цвет маркера</label>
                                        <div class="flex gap-2 items-center mt-1">
                                            <input type="color" name="color" id="houseProblemColor" required
                                                   class="w-12 h-8 rounded border border-gray-300 cursor-pointer"
                                                   value="#DC2626">
                                            <span class="text-sm text-gray-500">Выберите цвет для маркеров на карте</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" id="saveHouseProblem" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Сохранить
                        </button>
                        <button type="button" id="cancelHouseProblem" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно просмотра объявления -->
    <div id="listingModal" class="fixed inset-0 z-50 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="mx-auto flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>

            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-6xl sm:w-full relative z-10 max-h-[90vh]">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="w-full">
                            <!-- Заголовок -->
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                    Детали объявления
                                </h3>
                                <button type="button" id="closeModalBtn" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>

                            <!-- Содержимое -->
                            <div id="modalContent" class="max-h-[70vh] overflow-y-auto">
                                <!-- Контент будет загружен динамически -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 border-t border-gray-200">
                    <div class="flex items-center justify-between space-x-4">
                        <!-- Панель управления объявлением -->
                        <div id="modalFooterManagement" class="flex-1 p-3 bg-white rounded-lg border border-gray-200">
                            <!-- Содержимое панели управления будет загружено динамически -->
                        </div>
                        
                        <!-- Кнопка закрытия модального окна -->
                        <button type="button" id="closeModalFooterBtn"
                                class="w-auto inline-flex justify-center border border-gray-300 shadow-sm px-4 py-2 bg-white text-gray-700 text-base font-medium text-sm rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            ✕ Закрыть
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно просмотра объекта недвижимости -->
    <div id="objectModal" class="fixed inset-0 z-50 overflow-y-auto hidden" aria-labelledby="object-modal-title" role="dialog" aria-modal="true">
        <div class="mx-auto flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>

            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-6xl sm:w-full relative z-10 max-h-[90vh]">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="w-full">
                            <!-- Заголовок -->
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg leading-6 font-medium text-gray-900" id="object-modal-title">
                                    Детали объекта недвижимости
                                </h3>
                                <button type="button" id="closeObjectModalBtn" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>

                            <!-- Содержимое -->
                            <div id="objectModalContent" class="max-h-[70vh] overflow-y-auto">
                                <!-- Контент будет загружен динамически -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="closeObjectModalBtn2"
                            class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Закрыть
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно создания/редактирования сегмента -->
    <div id="segmentModal" class="fixed inset-0 z-50 overflow-y-auto hidden" aria-labelledby="segment-modal-title" role="dialog" aria-modal="true">
        <div class="mx-auto flex items-center justify-center min-h-screen pt-4 px-4 pb-4 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 z-0 transition-opacity" style="background-color: rgba(0, 0, 0, 0.1);" aria-hidden="true"></div>
            
            <!-- Выравнивание центра -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Содержимое модального окна -->
            <div class="inline-block align-bottom bg-white border rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-6xl sm:w-full relative z-10 h-[90vh] flex flex-col">
                <form id="segmentForm" class="flex flex-col h-full">
                    <!-- Хедер -->
                    <div class="bg-white px-4 pt-5 pb-4 sm:px-6 border-b border-gray-200 flex-shrink-0">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="segment-modal-title">
                                Создать сегмент
                            </h3>
                            <button type="button" id="closeSegmentModalBtn" class="text-gray-400 hover:text-gray-600">
                                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Содержимое с прокруткой -->
                    <div class="flex-1 overflow-y-auto px-4 py-4 sm:px-6 min-h-0">
                                    <!-- Скрытые поля -->
                                    <input type="hidden" name="id" id="segmentId">
                                    <input type="hidden" name="map_area_id" id="segmentMapAreaId">
                                    
                                    <!-- Блок фильтров сегмента -->
                                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6">
                                        <div class="flex items-center justify-between mb-4">
                                            <h4 class="text-md font-medium text-gray-900">Фильтры сегмента</h4>
                                            <!-- Название сегмента перенесено сюда -->
                                            <div class="flex-1 ml-4">
                                                <label for="segmentName" class="block text-sm font-medium text-gray-700">Название сегмента</label>
                                                <input type="text" name="name" id="segmentName" required
                                                       class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                                       placeholder="Название будет сгенерировано автоматически">
                                            </div>
                                        </div>
                                        
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">

                                            <!-- Тип недвижимости -->
                                            <div>
                                                <label for="segmentType" class="block text-sm font-medium text-gray-700">Тип недвижимости</label>
                                                <select name="type" id="segmentType" multiple class="slim-select">
                                                    <option value="house">Дом</option>
                                                    <option value="house_with_land">Дом с участком</option>
                                                    <option value="land">Участок</option>
                                                    <option value="commercial">Коммерческая</option>
                                                    <option value="building">Здание</option>
                                                </select>
                                            </div>

                                            <!-- Класс дома -->
                                            <div>
                                                <label for="segmentHouseClass" class="block text-sm font-medium text-gray-700">Класс дома</label>
                                                <select name="house_class_id" id="segmentHouseClass" multiple class="slim-select">
                                                    <!-- Опции будут загружены динамически -->
                                                </select>
                                            </div>

                                            <!-- Серия дома -->
                                            <div>
                                                <label for="segmentHouseSeries" class="block text-sm font-medium text-gray-700">Серия дома</label>
                                                <select name="house_series_id" id="segmentHouseSeries" multiple class="slim-select">
                                                    <!-- Опции будут загружены динамически -->
                                                </select>
                                            </div>

                                            <!-- Материал стен -->
                                            <div>
                                                <label for="segmentWallMaterial" class="block text-sm font-medium text-gray-700">Материал стен</label>
                                                <select name="wall_material_id" id="segmentWallMaterial" multiple class="slim-select">
                                                    <!-- Опции будут загружены динамически -->
                                                </select>
                                            </div>

                                            <!-- Материал перекрытий -->
                                            <div>
                                                <label for="segmentCeilingMaterial" class="block text-sm font-medium text-gray-700">Материал перекрытий</label>
                                                <select name="ceiling_material_id" id="segmentCeilingMaterial" multiple class="slim-select">
                                                    <!-- Опции будут загружены динамически -->
                                                </select>
                                            </div>

                                            <!-- Газоснабжение -->
                                            <div>
                                                <label for="segmentGasSupply" class="block text-sm font-medium text-gray-700">Газоснабжение</label>
                                                <select name="gas_supply" id="segmentGasSupply" multiple class="slim-select">
                                                    <option value="">Не указано</option>
                                                    <option value="true">Да</option>
                                                    <option value="false">Нет</option>
                                                </select>
                                            </div>

                                            <!-- Индивидуальное отопление -->
                                            <div>
                                                <label for="segmentIndividualHeating" class="block text-sm font-medium text-gray-700">Индивидуальное отопление</label>
                                                <select name="individual_heating" id="segmentIndividualHeating" multiple class="slim-select">
                                                    <option value="">Не указано</option>
                                                    <option value="true">Да</option>
                                                    <option value="false">Нет</option>
                                                </select>
                                            </div>

                                            <!-- Закрытая территория -->
                                            <div>
                                                <label for="segmentClosedTerritory" class="block text-sm font-medium text-gray-700">Закрытая территория</label>
                                                <select name="closed_territory" id="segmentClosedTerritory" multiple class="slim-select">
                                                    <option value="">Не указано</option>
                                                    <option value="true">Да</option>
                                                    <option value="false">Нет</option>
                                                </select>
                                            </div>

                                            <!-- Подземная парковка -->
                                            <div>
                                                <label for="segmentUndergroundParking" class="block text-sm font-medium text-gray-700">Подземная парковка</label>
                                                <select name="underground_parking" id="segmentUndergroundParking" multiple class="slim-select">
                                                    <option value="">Не указано</option>
                                                    <option value="true">Да</option>
                                                    <option value="false">Нет</option>
                                                </select>
                                            </div>

                                            <!-- Коммерческие помещения -->
                                            <div>
                                                <label for="segmentCommercialSpaces" class="block text-sm font-medium text-gray-700">Коммерческие помещения</label>
                                                <select name="commercial_spaces" id="segmentCommercialSpaces" multiple class="slim-select">
                                                    <option value="0">Не указано</option>
                                                    <option value="1">Да</option>
                                                    <option value="2">Нет</option>
                                                </select>
                                            </div>

                                            <!-- Этажность -->
                                            <div class="grid grid-cols-2 gap-2">
                                                <div>
                                                    <label for="segmentFloorsFrom" class="block text-sm font-medium text-gray-700">Этажей от</label>
                                                    <input type="number" name="floors_from" id="segmentFloorsFrom" min="1" max="100"
                                                           class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                                           placeholder="1">
                                                </div>
                                                <div>
                                                    <label for="segmentFloorsTo" class="block text-sm font-medium text-gray-700">Этажей до</label>
                                                    <input type="number" name="floors_to" id="segmentFloorsTo" min="1" max="100"
                                                           class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                                           placeholder="100">
                                                </div>
                                            </div>

                                            <!-- Годы постройки -->
                                            <div class="grid grid-cols-2 gap-2">
                                                <div>
                                                    <label for="segmentBuildYearFrom" class="block text-sm font-medium text-gray-700">Год от</label>
                                                    <input type="number" name="build_year_from" id="segmentBuildYearFrom" min="1800" max="2100"
                                                           class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                                           placeholder="1800">
                                                </div>
                                                <div>
                                                    <label for="segmentBuildYearTo" class="block text-sm font-medium text-gray-700">Год до</label>
                                                    <input type="number" name="build_year_to" id="segmentBuildYearTo" min="1800" max="2100"
                                                           class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                                           placeholder="2024">
                                                </div>
                                            </div>

                                            <!-- Высота потолков -->
                                            <div class="grid grid-cols-2 gap-2">
                                                <div>
                                                    <label for="segmentCeilingHeightFrom" class="block text-sm font-medium text-gray-700">Высота потолка от</label>
                                                    <input type="number" name="ceiling_height_from" id="segmentCeilingHeightFrom" min="1" max="10" step="0.1"
                                                           class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                                           placeholder="2.0">
                                                </div>
                                                <div>
                                                    <label for="segmentCeilingHeightTo" class="block text-sm font-medium text-gray-700">Высота потолка до</label>
                                                    <input type="number" name="ceiling_height_to" id="segmentCeilingHeightTo" min="1" max="10" step="0.1"
                                                           class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                                                           placeholder="4.0">
                                                </div>
                                            </div>

                                            <!-- Выбор адресов -->
                                            <div class="lg:col-span-3">
                                                <label for="segmentAddresses" class="block text-sm font-medium text-gray-700">Выбор адресов</label>
                                                <select name="addresses" id="segmentAddresses" multiple class="slim-select">
                                                    <!-- Опции будут загружены динамически -->
                                                </select>
                                                <p class="mt-1 text-sm text-gray-500">
                                                    Выберите адреса, которые должны входить в сегмент (повторное нажатие для отмены выбора)
                                                </p>
                                            </div>

                                            <!-- Кнопки управления сегментом -->
                                            <div class="flex flex-col items-end space-y-2">
                                                <button type="submit" id="saveSegmentBtn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:text-sm disabled:bg-gray-400 disabled:cursor-not-allowed">
                                                    Сохранить сегмент
                                                </button>
                                                
                                                <button type="button" id="clearFiltersBtn" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 sm:text-sm">
                                                    <svg class="-ml-1 mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H9a1 1 0 00-1 1v1M4 7h16"></path>
                                                    </svg>
                                                    Очистить фильтры
                                                </button>
                                                
                                                <!-- Индикатор несохраненных изменений -->
                                                <div id="unsavedChangesIndicator" class="mt-2 text-xs text-amber-600 font-medium hidden">
                                                    <div class="flex items-center">
                                                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                                        </svg>
                                                        Есть несохраненные изменения
                                                    </div>
                                                    <button type="button" id="cancelChangesBtn" class="mt-1 text-xs text-blue-600 hover:text-blue-800 underline">
                                                        Отменить изменения
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Фильтры отображения карты -->
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Отображение маркеров</label>
                                        <div class="flex flex-wrap items-center gap-2">
                                            <button type="button" id="segmentFilterByYear" data-filter="year" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Год
                                            </button>
                                            <button type="button" id="segmentFilterBySeries" data-filter="series" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Серия
                                            </button>
                                            <button type="button" id="segmentFilterByFloors" data-filter="floors" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Этажность
                                            </button>
                                            <button type="button" id="segmentFilterByObjects" data-filter="objects" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Объектов
                                            </button>
                                            <button type="button" id="segmentFilterByListings" data-filter="listings" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Объявлений
                                            </button>
                                            <button type="button" id="segmentFilterByHouseClass" data-filter="house_class" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Класс дома
                                            </button>
                                            <button type="button" id="segmentFilterByHouseProblems" data-filter="house_problems" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Проблемы дома
                                            </button>
                                            <button type="button" id="segmentFilterByCommercialSpaces" data-filter="commercial_spaces" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Коммерческие помещения
                                            </button>
                                            <button type="button" id="segmentFilterByComment" data-filter="comment" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Комментарий
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Карта на всю ширину -->
                                    <div class="mb-6">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Карта с адресами</label>
                                        <div id="segmentMap" style="height: 500px; width: 100%;" class="border border-gray-300 rounded-md"></div>
                                    </div>

                                    <!-- График распределения площадей -->
                                    <div class="mb-6">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Распределение площадей по типам недвижимости</label>
                                        <div id="areaDistributionChart" class="border border-gray-300 rounded-md bg-white" style="height: 350px; width: 100%;"></div>
                                    </div>

                                    <!-- Фильтр подсегментов -->
                                    <div class="mb-6 bg-blue-50 p-4 rounded-lg border border-blue-200">
                                        <div class="flex items-center justify-between mb-4">
                                            <h4 class="text-md font-medium text-gray-900">Фильтр подсегментов</h4>
                                            <div class="flex space-x-2">
                                                <button type="button" id="saveSubsegmentBtn" class="inline-flex justify-center rounded-md border border-transparent shadow-sm px-3 py-1 bg-blue-600 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                                    Сохранить подсегмент
                                                </button>
                                                <button type="button" id="deleteSubsegmentBtn" class="inline-flex justify-center rounded-md border border-transparent shadow-sm px-3 py-1 bg-red-600 text-sm font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                                                    Удалить подсегмент
                                                </button>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                            <!-- Скрытые поля для подсегмента -->
                                            <input type="hidden" id="subsegmentId">
                                            <input type="hidden" id="subsegmentSegmentId">

                                            <!-- Выбор существующего подсегмента -->
                                            <div class="lg:col-span-2">
                                                <label for="subsegmentSelect" class="block text-sm font-medium text-gray-700">Выбор подсегмента</label>
                                                <select id="subsegmentSelect" class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6">
                                                    <option value="">Создать новый подсегмент</option>
                                                    <!-- Подсегменты будут загружены динамически -->
                                                </select>
                                            </div>

                                            <!-- Название подсегмента -->
                                            <div class="lg:col-span-2">
                                                <label for="subsegmentName" class="block text-sm font-medium text-gray-700">Название подсегмента</label>
                                                <input type="text" id="subsegmentName" 
                                                       class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6"
                                                       placeholder="Название будет сгенерировано автоматически" readonly>
                                            </div>

                                            <!-- Тип недвижимости -->
                                            <div>
                                                <label for="subsegmentPropertyType" class="block text-sm font-medium text-gray-700">Тип недвижимости</label>
                                                <select id="subsegmentPropertyType" multiple class="slim-select">
                                                    <option value="studio">Студия</option>
                                                    <option value="1k">1-комнатная</option>
                                                    <option value="2k">2-комнатная</option>
                                                    <option value="3k">3-комнатная</option>
                                                    <option value="4k">4+ комнатная</option>
                                                </select>
                                            </div>

                                            <!-- Общая площадь -->
                                            <div class="grid grid-cols-2 gap-2">
                                                <div>
                                                    <label for="subsegmentAreaFrom" class="block text-sm font-medium text-gray-700">Площадь от (м²)</label>
                                                    <input type="number" id="subsegmentAreaFrom" min="1" max="500"
                                                           class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6"
                                                           placeholder="1">
                                                </div>
                                                <div>
                                                    <label for="subsegmentAreaTo" class="block text-sm font-medium text-gray-700">Площадь до (м²)</label>
                                                    <input type="number" id="subsegmentAreaTo" min="1" max="500"
                                                           class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6"
                                                           placeholder="500">
                                                </div>
                                            </div>

                                            <!-- Этаж -->
                                            <div class="grid grid-cols-2 gap-2">
                                                <div>
                                                    <label for="subsegmentFloorFrom" class="block text-sm font-medium text-gray-700">Этаж от</label>
                                                    <input type="number" id="subsegmentFloorFrom" min="1" max="100"
                                                           class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6"
                                                           placeholder="1">
                                                </div>
                                                <div>
                                                    <label for="subsegmentFloorTo" class="block text-sm font-medium text-gray-700">Этаж до</label>
                                                    <input type="number" id="subsegmentFloorTo" min="1" max="100"
                                                           class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6"
                                                           placeholder="100">
                                                </div>
                                            </div>

                                            <!-- Цена -->
                                            <div class="grid grid-cols-2 gap-2">
                                                <div>
                                                    <label for="subsegmentPriceFrom" class="block text-sm font-medium text-gray-700">Цена от</label>
                                                    <input type="number" id="subsegmentPriceFrom" min="1" max="10000000000"
                                                           class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6"
                                                           placeholder="1">
                                                </div>
                                                <div>
                                                    <label for="subsegmentPriceTo" class="block text-sm font-medium text-gray-700">Цена до</label>
                                                    <input type="number" id="subsegmentPriceTo" min="1" max="10000000000"
                                                           class="mt-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6"
                                                           placeholder="10000000000">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Таблица подсегментов -->
                                    <div class="mb-6">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Подсегменты</label>
                                        <div class="overflow-x-auto">
                                            <table id="subsegmentsTable" class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-md">
                                                <thead class="bg-gray-50">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            Название
                                                        </th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            Тип недвижимости
                                                        </th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            Площадь (м²)
                                                        </th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            Этажи
                                                        </th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            Цена
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody class="bg-white divide-y divide-gray-200">
                                                    <!-- Строки будут добавлены динамически -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                    </div>
                    
                    <!-- Футер -->
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 border-t border-gray-200 flex-shrink-0 flex flex-row-reverse space-x-reverse space-x-3">
                        <button type="button" id="closeSegmentModalFooterBtn" class="inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:text-sm">
                            Закрыть
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript библиотеки -->
    <script src="../libs/jquery/jquery-3.7.1.min.js"></script>
    <script src="../libs/datatables/datatables.min.js"></script>
    <script src="../libs/fotorama/fotorama.js"></script>
    <script src="../libs/apexcharts/apexcharts.js"></script>
    
    <!-- База данных и модели ПЕРВЫМИ - для доступности db объекта -->
    <script src="../data/database.js"></script>
    <script src="../data/models.js"></script>
    
    <!-- Утилиты -->
    <script src="../utils/geometry-utils.js"></script>
    <script src="../utils/geo-utils.js"></script>
    <script src="../utils/spatial-index-manager.js"></script>
    <script src="../utils/marker-cluster.js"></script>
    <script src="../utils/debug-logger.js"></script>
    <script src="../utils/real-estate-object-manager.js"></script>
    <script src="../utils/duplicate-detector.js"></script>
    <script src="../utils/advanced-duplicate-detector.js"></script>
    <script src="../utils/advanced-address-matcher.js"></script>
    <script src="../utils/smart-address-matcher.js"></script>
    <script src="../utils/ml-address-analyzer.js"></script>
    <script src="../utils/reforma-gkh-reference-resolver.js"></script>
    <script src="../utils/reforma-gkh-importer.js"></script>
    
    <!-- Модульная архитектура -->
    <!-- Основные системы -->
    <script src="core/DataState.js"></script>
    <script src="core/EventBus.js"></script>
    <script src="core/ProgressManager.js"></script>
    
    <!-- Общие утилиты -->
    <script src="shared/constants.js"></script>
    <script src="shared/helpers.js"></script>
    <script src="shared/validators.js"></script>
    
    <!-- Менеджеры функциональности -->
    <script src="managers/UIManager.js"></script>
    <script src="managers/MapManager.js"></script>
    <script src="managers/ParsingManager.js"></script>
    <script src="managers/AddressManager.js"></script>
    <script src="managers/DuplicatesManager.js"></script>
    <script src="managers/SegmentsManager.js"></script>
    <script src="managers/ReportsManager.js"></script>
    <script src="managers/FlippingProfitabilityManager.js"></script>
    <script src="managers/HTMLExportManager.js"></script>
    <script src="managers/ComparativeAnalysisManager.js"></script>
    <script src="managers/GeoJsonImportManager.js"></script>
    
    <!-- Сервисная архитектура (существующая) -->
    <script src="../services/base/BaseAPIService.js"></script>
    <script src="../services/base/ServiceManager.js"></script>
    <script src="../services/external/InparsService.js"></script>
    <script src="../services/ui/InparsPanel.js"></script>
    <script src="../services/ServiceConfig.js"></script>
    
    <!-- Сервисы v0.1 -->
    <script src="../services/core/ValidationService.js"></script>
    <script src="../services/core/ConfigService.js"></script>
    <script src="../services/core/ErrorHandlingService.js"></script>
    <script src="../services/core/GlobalErrorReporter.js"></script>
    <script src="../services/core/DIContainer.js"></script>
    <script src="../services/data/ReferenceDataService.js"></script>
    <script src="../services/data/SegmentService.js"></script>
    
    <!-- UI Компоненты v0.1 -->
    <script src="../components/ui/SegmentModal.js"></script>
    <script src="../components/ui/SegmentTable.js"></script>
    <script src="../components/ui/SegmentChart.js"></script>
    
    <!-- Map компоненты v0.1 -->
    <script src="../components/map/MapRenderer.js"></script>
    <script src="../components/map/MarkerManager.js"></script>
    
    <!-- Сервисы данных v0.1 -->
    <script src="../services/data/RealEstateObjectService.js"></script>
    
    <!-- UI компоненты v0.1 (должны загружаться ПЕРЕД контроллерами) -->
    <script src="../services/FlippingProfitabilityService.js"></script>
    <script src="../components/ui/FlippingTable.js"></script>
    <script src="../components/map/FlippingMap.js"></script>
    
    <!-- Контроллеры v0.1 -->
    <script src="../controllers/SegmentController.js"></script>
    <script src="../controllers/MapController.js"></script>
    <script src="../controllers/FlippingController.js"></script>
    <script src="../controllers/ApplicationController.js"></script>
    
    <!-- Интеграция сервисов (существующая) -->
    <script src="area_services_integration.js"></script>
    
    <!-- Главная страница (модульная версия) -->
    <script src="area.js"></script>
    
    <!-- Интеграция современной архитектуры -->
    <script src="area_architecture_integration.js"></script>

</body>
</html>